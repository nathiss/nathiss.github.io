<!doctype html><html lang=en data-theme=light class=h-full><head><script>{const e=localStorage.theme;if(e!==null)document.documentElement.setAttribute("data-theme",e);else{const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",e)}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-CXYG0Q9PH0"></script><script>var dnt,doNotTrack=!1;if(!0&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CXYG0Q9PH0")}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet type=text/css href=https://madebyme.today/stylesheets/output.min.ef73616c18e6dbb7d0c4b06eb168690961d9fa5d5bbd25e9648a55378c8cf04c1e9409e82cd71efe6ba538a047420e54e491653eda9a46327b49414db89ddc6f.css integrity="sha512-73NhbBjm27fQxLBusWhpCWHZ+l1bvSXpZIpVN4yM8EwelAnoLNce/mulOKBHQg5U5JFlPtqaRjJ7SUFNuJ3cbw=="><link rel=stylesheet type=text/css href=https://madebyme.today/stylesheets/syntax/light.min.f8c5af1bbcb050c9a0f9bc73e6a627b23a8825d8537cb416518426e6d791257ade4676cd57fcabcbb1542e43618a986520126eae9a236ba2937a49b8db8968f0.css integrity="sha512-+MWvG7ywUMmg+bxz5qYnsjqIJdhTfLQWUYQm5teRJXreRnbNV/yry7FULkNhiphlIBJurpoja6KTekm424lo8A=="><link rel=stylesheet type=text/css href=https://madebyme.today/stylesheets/syntax/dark.min.e82275a221c102f04ff48a5a0444f4753cd8fe31e437176a94bb4d1f80d0fce5027a1414ad6ad9d0b8ab893f421c6cf15be886ffb228b55cd8cd85399d60ef99.css integrity="sha512-6CJ1oiHBAvBP9IpaBET0dTzY/jHkNxdqlLtNH4DQ/OUCehQUrWrZ0LiriT9CHGzxW+iG/7IotVzYzYU5nWDvmQ=="><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://madebyme.today/favicons/favicon-16x16-box-light.png><link rel=icon type=image/png sizes=32x32 href=https://madebyme.today/favicons/favicon-32x32-box-light.png><link rel=icon type=image/png sizes=64x64 href=https://madebyme.today/favicons/favicon-64x64-box-light.png><link rel=apple-touch-icon sizes=180x180 href=https://madebyme.today/favicons/favicon-180x180-box-light.png><link rel=stylesheet href=/3rd-party/katex@v0.16.9/katex.min.css><script defer src=/3rd-party/katex@v0.16.9/katex.min.js></script><script defer src=/3rd-party/katex@v0.16.9/contrib/auto-render.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><link rel=canonical href=https://madebyme.today/blog/franklin/randomness-of-life/><link rel=alternate type=application/rss+xml href=https://madebyme.today/index.xml title=MadeByMe><meta name=description content="In the previous article from this series, we&rsquo;ve talked about
genetic algorithms and how they can be used to generate art. Now let&rsquo;s put those ideas into action and focus on
implementing the first part of our artistic toolset: mutators."><meta name=author content="Kamil Rusin"><meta name=msapplication-TileColor content="#f5f5f5"><meta name=theme-color content="#f5f5f5"><meta name=twitter:dnt content="on"><meta name=title property="og:title" content="Randomness of Life"><meta property="og:description" content="
        
            In the previous article from this series, we&rsquo;ve talked about
genetic algorithms and how they can be used to generate art. Now let&rsquo;s put those ideas into action and focus on
implementing the first part of our artistic toolset: mutators.
        
    "><meta property="og:type" content="
        article
    "><meta property="og:url" content="https://madebyme.today/blog/franklin/randomness-of-life/"><meta name=image property="og:image" content="https://madebyme.today/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.jpg"><meta name=image property="og:image" content="https://madebyme.today/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.webp"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-03-20T10:02:19+01:00"><meta property="article:modified_time" content="2023-03-20T10:02:19+01:00"><meta property="article:author" content="Kamil Rusin"><meta property="og:site_name" content="MadeByMe"><meta property="og:see_also" content="https://madebyme.today/blog/franklin/art-from-chaos/"><meta property="og:see_also" content="https://madebyme.today/blog/franklin/natural-selection-and-loss-functions/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://madebyme.today/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.jpg"><meta name=twitter:title content="Randomness of Life"><meta name=twitter:description content="In the previous article from this series, we’ve talked about genetic algorithms and how they can be used to generate art. Now let’s put those ideas into action and focus on implementing the first part of our artistic toolset: mutators."><meta name=twitter:site content="@AreElectrons"><meta name=generator content="Hugo 0.133.0"><title>Randomness of Life - MadeByMe</title>
<script>const themeToColor={light:"#F5F5F5",dark:"#2A303C"},giscusSendMessage=e=>{const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")},getTheme=()=>{const e=localStorage.getItem("theme");return e!==null?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},setTheme=e=>{localStorage.setItem("theme",e),reloadTheme(e)},reloadTheme=e=>{document.documentElement.setAttribute("data-theme",e),updateThemeCheckboxStatus(),giscusSendMessage({setConfig:{theme:getTheme()}});const t=themeToColor[e];document.querySelector('meta[name="theme-color"]').setAttribute("content",t),document.querySelector('meta[name="msapplication-TileColor"]').setAttribute("content",t)},setUserTheme=e=>{const t=e.checked?"dark":"light";setTheme(t)},updateThemeCheckboxStatus=()=>{const e=document.getElementById("theme-checkbox");e.checked=getTheme()==="dark"};window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{reloadTheme(getTheme())})</script><script>let FF_FOUC_FIX</script></head><body class="h-full flex flex-col"><nav class="navbar justify-between bg-base-100"><div class=navbar-start><div class=dropdown><div tabindex=0 role=button class="btn btn-ghost lg:hidden" aria-label=Menu><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16"/></svg></div><ul tabindex=0 class="menu dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow"><li><a href=https://madebyme.today/blog/ title=Blog class=nav-link>Blog</a></li><li><a href=https://madebyme.today/projects/ title=Projects class=nav-link>Projects</a></li><li><a href=https://jungle.madebyme.today/ title="Welcome to the 🌴 Jungle!" class=nav-link>🌴 Jungle</a></li><li><a href=https://madebyme.today/cv/ title=Resumé class=nav-link>Resumé</a></li></ul></div><a class="btn btn-ghost text-xl flex flex-col text-primary font-bold" href=https://madebyme.today/>MadeByMe</a></div><div><div class="hidden lg:flex"><ul class="menu menu-horizontal px-1"><li><a href=https://madebyme.today/blog/ title=Blog class=nav-link>Blog</a></li><li><a href=https://madebyme.today/projects/ title=Projects class=nav-link>Projects</a></li><li><a href=https://jungle.madebyme.today/ title="Welcome to the 🌴 Jungle!" class=nav-link>🌴 Jungle</a></li><li><a href=https://madebyme.today/cv/ title=Resumé class=nav-link>Resumé</a></li></ul></div><label class="flex cursor-pointer gap-2" aria-label="Change theme"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2m18 0h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/></svg>
<input id=theme-checkbox type=checkbox value=dark aria-label="Change theme" onchange=setUserTheme(this) class="toggle theme-controller bg-primary-500 hover:bg-primary-500 dark:bg-darkmode-primary-500 dark:hover:bg-darkmode-primary-500"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></label></div></nav><main class="grow md:container px-6 !max-w-3xl"><nav class="breadcrumbs text-sm"><script type=application/ld+json>{"@context":"https://schema.org/","@type":"BreadcrumbList","itemListOrder":"ItemListOrderAscending","itemListElement":[{"@context":"https://schema.org/","@type":"ListItem","position":1,"name":"MadeByMe","item":"https://madebyme.today/","url":"https://madebyme.today/blog/franklin/randomness-of-life/"},{"@context":"https://schema.org/","@type":"ListItem","position":2,"name":"Blog","item":"https://madebyme.today/blog/","url":"https://madebyme.today/blog/franklin/randomness-of-life/"},{"@context":"https://schema.org/","@type":"ListItem","position":3,"name":"Franklin","item":"https://madebyme.today/blog/franklin/","url":"https://madebyme.today/blog/franklin/randomness-of-life/"},{"@context":"https://schema.org/","@type":"ListItem","position":4,"name":"Randomness of Life","item":"https://madebyme.today/blog/franklin/randomness-of-life/","url":"https://madebyme.today/blog/franklin/randomness-of-life/"}]}</script><ul><li><a class=hover:decoration-dashed href=https://madebyme.today/><span>root</span></a></li><li><a class=hover:decoration-dashed href=https://madebyme.today/blog/><span>Blog</span></a></li><li><a class=hover:decoration-dashed href=https://madebyme.today/blog/franklin/><span>Franklin</span></a></li><li><a class=hover:decoration-dashed href=https://madebyme.today/blog/franklin/randomness-of-life/><span>Randomness of Life</span></a></li></ul></nav><article class=entry><script type=application/ld+json>{"@context":"https://schema.org/","@type":"BlogPosting","name":"Randomness of Life","headline":"Randomness of Life | MadeByMe","alternativeHeadline":"Randomness of Life | MadeByMe","url":"https://madebyme.today/blog/franklin/randomness-of-life/","datePublished":"2023-03-20T10:02:19+01:00","inLanguage":"en-us","wordCount":1399,"isFamilyFriendly":"true","copyrightYear":"2023","copyrightHolder":{"@context":"https://schema.org/","@type":"Person","givenName":"Kamil","familyName":"Rusin","name":"Kamil Rusin"},"description":"In the previous article from this series, we\u0026rsquo;ve talked about genetic algorithms and how they can be used to generate art. Now let\u0026rsquo;s put those ideas into action and focus on implementing the first part of our artistic toolset: mutators.\n","publisher":{"@context":"https://schema.org/","@type":"Organization","name":"MadeByMe","url":"https://madebyme.today/"},"articleSection":"Franklin","image":["https://madebyme.today/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.jpg","https://madebyme.today/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.webp"],"thumbnailUrl":"https://madebyme.today/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.jpg","keywords":["Genetic Algorithm","Rust","Algorithm"],"mainEntityOfPage":"true","articleBody":"In the previous article from this series, we\u0026rsquo;ve talked about genetic algorithms and how they can be used to generate art. Now let\u0026rsquo;s put those ideas into action and focus on implementing the first part of our artistic toolset: mutators.\nPreparing the ecosystem Before we begin working on mutators, we need to prepare an environment in which our specimens can thrive. We don\u0026rsquo;t need much - right now the only thing is a generation. For the record, in this context, a generation is a collection of specimen which can be mutated, scored, and bred (basically experimented upon) to get us closer to the optimum. Since our specimens are images, they can be represented by the following structs:\n1struct Pixel { 2 r: u8, 3 g: u8, 4 b: u8, 5} 6 7struct Image { 8 height: usize, 9 width: usize, 10 pixels: Vec\u0026lt;Pixel\u0026gt;, 11} Representing each pixel as a 24-bit value gives us some flexibility here \u0026ndash; it allows us to operate on two color depths: true color (which uses 24-bit colors) and grayscale (8-bit). Creating a grayscale pixel can be done by setting up all color channels to the same value. True, it uses thrice as much memory as it could, but\u0026hellip;\nPremature optimization is the root of all evil.\n~ Donald Knuth\nMethod of initializing1 the generation will affect how fast we can search the solution space. As the algorithm produces more fitted images, the specimens get closed to the source image. But we don\u0026rsquo;t really care about how fast the optimum can be achieved, frankly, we don\u0026rsquo;t really care about achieving the optimum in the first place. It is the process of getting more fitted images and seeing how they evolve what\u0026rsquo;s really interesting. Therefore our generation will be initialized by blank images - images filled by white pixels. It will reduce pace of solution space search, but will produce images that are more visually interesting. We are here to do art, after all. \u0026#x1f3a8;\n1impl Pixel { 2 #[must_use] 3 pub const fn white() -\u0026gt; Self { 4 Pixel::new(255, 255, 255) 5 } 6 7 #[must_use] 8 pub const fn new(r: u8, g: u8, b: u8) -\u0026gt; Self { 9 Pixel { r, g, b } 10 } 11} 12 13impl Image { 14 #[must_use] 15 pub fn new(height: usize, width: usize, pixels: Vec\u0026lt;Pixel\u0026gt;) -\u0026gt; Self { 16 Self { 17 height, 18 width, 19 pixels, 20 } 21 } 22 23 #[must_use] 24 pub fn blank(height: usize, width: usize, pixel: \u0026amp;Pixel) -\u0026gt; Self { 25 let size = height * width; 26 let pixels = vec![pixel.clone(); size]; 27 28 Self::new(height, width, pixels) 29 } 30} 31 32#[must_use] 33fn get_first_generation( 34 vec_len: usize, 35 image_height: usize, 36 image_width: usize 37) -\u0026gt; Vec\u0026lt;Image\u0026gt; { 38 let pixel = Pixel::white(); 39 vec![Image::blank(height, width, \u0026amp;pixel); vec_len] 40} This code takes care of initializing the generation. \u0026#x1f44c;\nThrowing dice and hoping for the best As was mentioned in the previous article, mutators act only on one specimen at a time, inserting random modification onto it. With that description alone, we can already define a contract for all mutators we\u0026rsquo;re going to implement:\n1pub trait Mutator { 2 fn mutate(\u0026amp;self, image: \u0026amp;mut Image); 3} Why \u0026amp;self and not \u0026amp;mut self? Due to the fact that mutations are independent of one another, they can be performed concurrently. In fact, as we will see in the future articles, mutating and scoring are the only steps that can be easily run in parallel.\nA diagram showing the flow of actions applied on a single generation.\nThrowing a rectangular dice Rectangles are the easiest shape to draw both algorithmically and IRL; our first mutator will use rectangles as a mutation primitive. To generate a random rectangle we need have the following:\ncoordinates of one of its corners, width, height, fill color. Fill color is pretty straightforward, but other values have some constraints they need to meet. An image we\u0026rsquo;ll be mutating has width and height \u0026ndash; let\u0026rsquo;s assume it\u0026rsquo;s n and m respectively. Coordinates of one of the corners, in our case it\u0026rsquo;s going to be top-left, are limited by the image dimensions. Width and height are limited by both image dimensions, and the coordinates we just generated.\n$$ x \\in \\lbrack 0 .. n \\lbrack \\newline y \\in \\lbrack 0 .. m \\lbrack \\newline width \\in \\lbrack 1 .. n - x + 1 \\lbrack \\newline height \\in \\lbrack 1 .. m - y + 1 \\lbrack \\newline $$\nWhy coordinates intervals are right-open? Because if the mutator selects the very right or bottom edge, then the rectangle would need to have zero width/height. By not right-closing the intervals, we ensure that there\u0026rsquo;s at least one pixel which can be mutated \u0026#x1f44c;. Similarly both width and height intervals are right-open to ensure that the rectangle will not overflow the image.\n1struct RandomRectangle { 2 x: usize, 3 y: usize, 4 width: usize, 5 height: usize, 6} 7 8#[must_use] 9fn get_random_rectangle(random: \u0026amp;mut Random, image: \u0026amp;Image) -\u0026gt; RandomRectangle { 10 let image_width = image.width(); 11 let image_height = image.height(); 12 13 let x = random.get_random(0usize, image_width); 14 let y = random.get_random(0usize, image_height); 15 16 let width = random.get_random(0usize, image_width - x) + 1; 17 let height = random.get_random(0usize, image_height - y) + 1; 18 19 RandomRectangle { 20 x, 21 y, 22 width, 23 height, 24 } 25} Function get_random_rectangle is a neat helper: based on the given RNG2 and image, it returns a struct representing a random rectangle within the boundaries of the image.\nOnly two things left to do: generate random color and draw the shape. The implementation of rectangle mutator will look like this:\n1#[derive(Debug, Default)] 2pub struct RectangleMutator; 3 4impl Mutator for RectangleMutator { 5 fn mutate(\u0026amp;self, image: \u0026amp;mut Image) { 6 let mut random = Random::default(); 7 let rect = get_random_rectangle(\u0026amp;mut random, image); 8 9 let r = random.get_random(0u8, 255); 10 let g = random.get_random(0u8, 255); 11 let b = random.get_random(0u8, 255); 12 13 let image_width = image.width(); 14 15 for j in rect.y..(rect.height + rect.y) { 16 for i in rect.x..(rect.width + rect.x) { 17 let pixel = \u0026amp;mut image[j * image_width + i]; 18 pixel.r(r); 19 pixel.g(g); 20 pixel.b(b); 21 } 22 } 23 } 24} The implementation is really simple. First we get a random rectangle (using the helper function), then generate color channels, and finally draw the shape. Drawing itself is done by two nested loops iterating over columns and rows of the image. With the two indexes it references a specific pixel: j * image_width + 1 and finally overrides it using the color channels.\nCool, let\u0026rsquo;s see what the program generates after 10 000 generations when initialized with \u0026ldquo;Mona Lisa\u0026rdquo;.\nMona Lisa (generation #10 000) Doesn\u0026rsquo;t really looks like anything. \u0026#x1f610;\nWhich isn\u0026rsquo;t very surprising; the code did what it was suppose to do: it generated random rectangles on the white image. Since we don\u0026rsquo;t have any scoring logic yet (that\u0026rsquo;s a topic for another article) the resulting image is composed of random noise. We\u0026rsquo;ll need to wait a bit longer to get an image that even remotely reflects \u0026ldquo;Mona Lisa\u0026rdquo;.\nThrowing dice of other shapes It\u0026rsquo;d be nice to have mutators other than RectangleMutator, which are able to mutate images with different shapes, but I\u0026rsquo;m not going to cover them here. The reason is simple \u0026ndash; they operate under the same rules: you need to define boundaries first and then you need to draw the desired shape. I\u0026rsquo;ve implemented two other mutators: TriangleMutator and CircleMutator. Their sources can be found on github.com/nathiss/franklin.\nAfterword You might\u0026rsquo;ve noticed that the code examples of this article are not strictly bounded together, meaning you cannot just copy them to have a working example. A bunch of things like: Random implementation, loading the original image, mutation loop, and the whole impl Image block are missing. If you want to have a working solution it\u0026rsquo;s github.com/nathiss/franklin (locked down to the newest commit at the moment of writing \u0026ndash; 73aa8da). The goal of this series is not to go through every single line of code to build a working utility, but rather to present an idea. So, moving forward all future articles from this series will also be done in that style.\nPhoto by Alexander Grey on Unsplash\nStay tuned \u0026#x1f30a;\nUsually the generation is generated randomly. See Genetic_algorithm.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\nRandom is a project-private utility class. Source can be found github.com/nathiss/franklin.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","aliases":["https://madebyme.today/articles/franklin/randomness-of-life"],"author":{"@context":"https://schema.org/","@type":"Person","gender":"male","email":"kamil.jakub.rusin@gmail.com","givenName":"Kamil","familyName":"Rusin","name":"Kamil Rusin","jobTitle":"Software Engineer","nationality":{"@context":"https://schema.org/","@type":"Country","name":"PL"},"alumniOf":{"@context":"https://schema.org/","@type":"CollegeOrUniversity","url":"https://www.pk.edu.pl/","name":"The Cracow University of Technology"},"url":"https:\/\/madebyme.today\/"}}</script><script type=application/ld+json>{"@context":"https://schema.org/","@type":"WPHeader","@id":"#article-title","cssSelector":"#article-title"}</script><header class=mt-3><h1 id=article-title class=text-3xl>Randomness of Life</h1></header><footer class="inline-flex gap-1 flex-wrap"><time datetime=2023-03-20T10:02:19>2023/03/20
</time><span class=select-none>·</span>
<span>7 min</span>
<span class=select-none>·</span>
<a class="btn btn-xs" role=button href=https://madebyme.today/tags/algorithm/>#Algorithm</a>
<a class="btn btn-xs" role=button href=https://madebyme.today/tags/genetic-algorithm/>#Genetic Algorithm</a>
<a class="btn btn-xs" role=button href=https://madebyme.today/tags/rust/>#Rust</a></footer><details class="collapse bg-base-200 my-3"><summary class="collapse-title text-lg font-medium">Table Of Contents</summary><div class="collapse-content table-of-contents markdown-body"><nav id=TableOfContents><ul><li><a href=#preparing-the-ecosystem>Preparing the ecosystem</a></li><li><a href=#throwing-dice-and-hoping-for-the-best>Throwing dice and hoping for the best</a><ul><li><a href=#throwing-a-rectangular-dice>Throwing a rectangular dice</a></li><li><a href=#throwing-dice-of-other-shapes>Throwing dice of other shapes</a></li></ul></li><li><a href=#afterword>Afterword</a></li></ul></nav></div></details><main class="my-4 markdown-body"><p>In <a href=/blog/franklin/art-from-chaos/>the previous article</a> from this series, we&rsquo;ve talked about
genetic algorithms and how they can be used to generate art. Now let&rsquo;s put those ideas into action and focus on
implementing the first part of our artistic toolset: <strong>mutators</strong>.</p><h2 id=preparing-the-ecosystem class="my-8 md:my-12 flex items-center justify-center"><hr class="w-1/12 border-neutral shrink-0 hidden md:block"><a class="font-bold text-center w-full md:w-fit mx-4 !no-underline !link-neutral" href=#preparing-the-ecosystem aria-label=Anchor>Preparing the ecosystem</a><hr class="w-1/12 border-neutral shrink-0 hidden md:block"></h2><p>Before we begin working on mutators, we need to prepare an environment in which our specimens can thrive. We don&rsquo;t need
much - right now the only thing is <em>a generation</em>. For the record, in this context, a generation is a collection of
specimen which can be mutated, scored, and bred (basically experimented upon) to get us closer to the optimum. Since our
specimens are images, they can be represented by the following structs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=ln id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a></span><span class=cl><span class=k>struct</span> <span class=nc>Pixel</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a></span><span class=cl><span class=w>    </span><span class=n>r</span>: <span class=kt>u8</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a></span><span class=cl><span class=w>    </span><span class=n>g</span>: <span class=kt>u8</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a></span><span class=cl><span class=w>    </span><span class=n>b</span>: <span class=kt>u8</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a></span><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Image</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a></span><span class=cl><span class=w>    </span><span class=n>height</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a></span><span class=cl><span class=w>    </span><span class=n>width</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a></span><span class=cl><span class=w>    </span><span class=n>pixels</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Pixel</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Representing each pixel as a 24-bit value gives us some flexibility here &ndash; it allows us to operate on two color depths:
<a href=https://en.wikipedia.org/wiki/Color_depth#True_color_(24-bit)>true color</a> (which uses 24-bit colors) and
<a href=https://en.wikipedia.org/wiki/Grayscale>grayscale</a> (8-bit). Creating a grayscale pixel can be done by setting up all
color channels to the same value. True, it uses thrice as much memory as it could, but&mldr;</p><blockquote><p>Premature optimization is the root of all evil.<br>~ Donald Knuth</p></blockquote><p><span class=text-decoration-underline>Method of initializing</span><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> the generation will affect how fast we can search the
solution space. As the algorithm produces more fitted images, the specimens get closed to the source image. But we don&rsquo;t
really care about how <em>fast</em> the optimum can be achieved, frankly, we don&rsquo;t really care about achieving the optimum in
the first place. It is <em>the process</em> of getting more fitted images and seeing how they evolve what&rsquo;s really interesting.
Therefore our generation will be initialized by blank images - images filled by white pixels. It will reduce pace of
solution space search, but will produce images that are more visually interesting. We are here to do art, after all.
&#x1f3a8;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=ln id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a></span><span class=cl><span class=k>impl</span><span class=w> </span><span class=n>Pixel</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a></span><span class=cl><span class=w>    </span><span class=cp>#[must_use]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a></span><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=k>fn</span> <span class=nf>white</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a></span><span class=cl><span class=w>        </span><span class=n>Pixel</span>::<span class=n>new</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=mi>255</span><span class=p>,</span><span class=w> </span><span class=mi>255</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a></span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a></span><span class=cl><span class=w>    </span><span class=cp>#[must_use]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a></span><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>r</span>: <span class=kt>u8</span><span class=p>,</span><span class=w> </span><span class=n>g</span>: <span class=kt>u8</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kt>u8</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a></span><span class=cl><span class=w>        </span><span class=n>Pixel</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a></span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a></span><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Image</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a></span><span class=cl><span class=w>    </span><span class=cp>#[must_use]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a></span><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>height</span>: <span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>width</span>: <span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>pixels</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Pixel</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a></span><span class=cl><span class=w>        </span><span class=bp>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a></span><span class=cl><span class=w>            </span><span class=n>height</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a></span><span class=cl><span class=w>            </span><span class=n>width</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a></span><span class=cl><span class=w>            </span><span class=n>pixels</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a></span><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a></span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a></span><span class=cl><span class=w>    </span><span class=cp>#[must_use]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a></span><span class=cl><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>blank</span><span class=p>(</span><span class=n>height</span>: <span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>width</span>: <span class=kt>usize</span><span class=p>,</span><span class=w> </span><span class=n>pixel</span>: <span class=kp>&amp;</span><span class=nc>Pixel</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>height</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>width</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>pixels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>vec!</span><span class=p>[</span><span class=n>pixel</span><span class=p>.</span><span class=n>clone</span><span class=p>();</span><span class=w> </span><span class=n>size</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a></span><span class=cl><span class=w>        </span><span class=bp>Self</span>::<span class=n>new</span><span class=p>(</span><span class=n>height</span><span class=p>,</span><span class=w> </span><span class=n>width</span><span class=p>,</span><span class=w> </span><span class=n>pixels</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a></span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a></span><span class=cl><span class=w></span><span class=cp>#[must_use]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-33><a class=lnlinks href=#hl-1-33>33</a></span><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>get_first_generation</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-34><a class=lnlinks href=#hl-1-34>34</a></span><span class=cl><span class=w>    </span><span class=n>vec_len</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-35><a class=lnlinks href=#hl-1-35>35</a></span><span class=cl><span class=w>    </span><span class=n>image_height</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-36><a class=lnlinks href=#hl-1-36>36</a></span><span class=cl><span class=w>    </span><span class=n>image_width</span>: <span class=kt>usize</span>
</span></span><span class=line><span class=ln id=hl-1-37><a class=lnlinks href=#hl-1-37>37</a></span><span class=cl><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Image</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-38><a class=lnlinks href=#hl-1-38>38</a></span><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>pixel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pixel</span>::<span class=n>white</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-39><a class=lnlinks href=#hl-1-39>39</a></span><span class=cl><span class=w>    </span><span class=fm>vec!</span><span class=p>[</span><span class=n>Image</span>::<span class=n>blank</span><span class=p>(</span><span class=n>height</span><span class=p>,</span><span class=w> </span><span class=n>width</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>pixel</span><span class=p>);</span><span class=w> </span><span class=n>vec_len</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-1-40><a class=lnlinks href=#hl-1-40>40</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This code takes care of initializing the generation. &#x1f44c;</p><h2 id=throwing-dice-and-hoping-for-the-best class="my-8 md:my-12 flex items-center justify-center"><hr class="w-1/12 border-neutral shrink-0 hidden md:block"><a class="font-bold text-center w-full md:w-fit mx-4 !no-underline !link-neutral" href=#throwing-dice-and-hoping-for-the-best aria-label=Anchor>Throwing dice and hoping for the best</a><hr class="w-1/12 border-neutral shrink-0 hidden md:block"></h2><p>As was mentioned in the previous article, mutators act only on one specimen at a time, inserting random modification
onto it. With that description alone, we can already define a contract for all mutators we&rsquo;re going to implement:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=ln id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a></span><span class=cl><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>Mutator</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a></span><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>mutate</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>image</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Image</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Why <code>&amp;self</code> and not <code>&amp;mut self</code>? Due to the fact that mutations are independent of one another, they can be performed
concurrently. In fact, as we will see in the future articles, mutating and scoring are the only steps that can be
<em>easily</em> run in parallel.</p><figure><img src=/blog/franklin/randomness-of-life/genetic-algorithm-flow.webp alt="Genetic Algorithm Flow" loading=lazy><figcaption><p>A diagram showing the flow of actions applied on a single generation.</p></figcaption></figure><h3 id=throwing-a-rectangular-dice class="my-8 md:my-12 flex items-center justify-center"><hr class="w-1/12 border-neutral shrink-0 hidden md:block"><a class="font-bold text-center w-full md:w-fit mx-4 !no-underline !link-neutral" href=#throwing-a-rectangular-dice aria-label=Anchor>Throwing a rectangular dice</a><hr class="w-1/12 border-neutral shrink-0 hidden md:block"></h3><p>Rectangles are the easiest shape to draw both algorithmically and IRL; our first mutator will use rectangles as a
mutation primitive. To generate a random rectangle we need have the following:</p><ul><li>coordinates of one of its corners,</li><li>width,</li><li>height,</li><li>fill color.</li></ul><p><em>Fill color</em> is pretty straightforward, but other values have some constraints they need to meet. An image we&rsquo;ll be
mutating has width and height &ndash; let&rsquo;s assume it&rsquo;s <span class=font-monospace>n</span> and <span class=font-monospace>m</span>
respectively. Coordinates of one of the corners, in our case it&rsquo;s going to be top-left, are limited by the image
dimensions. Width and height are limited by both image dimensions, and the coordinates we just generated.</p><p>$$
x \in \lbrack 0 .. n \lbrack \newline
y \in \lbrack 0 .. m \lbrack \newline
width \in \lbrack 1 .. n - x + 1 \lbrack \newline
height \in \lbrack 1 .. m - y + 1 \lbrack \newline
$$</p><p>Why coordinates intervals are right-open? Because if the mutator selects the very right or bottom edge, then the
rectangle would need to have zero width/height. By not right-closing the intervals, we ensure that there&rsquo;s at least one
pixel which can be mutated &#x1f44c;. Similarly both <span class=font-monospace>width</span> and <span class=font-monospace>height</span>
intervals are right-open to ensure that the rectangle will not overflow the image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=ln id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a></span><span class=cl><span class=k>struct</span> <span class=nc>RandomRectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a></span><span class=cl><span class=w>    </span><span class=n>x</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a></span><span class=cl><span class=w>    </span><span class=n>y</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a></span><span class=cl><span class=w>    </span><span class=n>width</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a></span><span class=cl><span class=w>    </span><span class=n>height</span>: <span class=kt>usize</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a></span><span class=cl><span class=w></span><span class=cp>#[must_use]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a></span><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>get_random_rectangle</span><span class=p>(</span><span class=n>random</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Random</span><span class=p>,</span><span class=w> </span><span class=n>image</span>: <span class=kp>&amp;</span><span class=nc>Image</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>RandomRectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a></span><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>image_width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>image</span><span class=p>.</span><span class=n>width</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a></span><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>image_height</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>image</span><span class=p>.</span><span class=n>height</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a></span><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=n>get_random</span><span class=p>(</span><span class=mi>0</span><span class=k>usize</span><span class=p>,</span><span class=w> </span><span class=n>image_width</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a></span><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=n>get_random</span><span class=p>(</span><span class=mi>0</span><span class=k>usize</span><span class=p>,</span><span class=w> </span><span class=n>image_height</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a></span><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=n>get_random</span><span class=p>(</span><span class=mi>0</span><span class=k>usize</span><span class=p>,</span><span class=w> </span><span class=n>image_width</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a></span><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>height</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=n>get_random</span><span class=p>(</span><span class=mi>0</span><span class=k>usize</span><span class=p>,</span><span class=w> </span><span class=n>image_height</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a></span><span class=cl><span class=w>    </span><span class=n>RandomRectangle</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a></span><span class=cl><span class=w>        </span><span class=n>x</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a></span><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a></span><span class=cl><span class=w>        </span><span class=n>width</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a></span><span class=cl><span class=w>        </span><span class=n>height</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a></span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Function <code>get_random_rectangle</code> is a neat helper: based on the given <span class=text-decoration-underline>RNG</span><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> and
image, it returns a struct representing a random rectangle within the boundaries of the image.</p><p>Only two things left to do: generate random color and draw the shape. The implementation of rectangle mutator will look
like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=ln id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a></span><span class=cl><span class=cp>#[derive(Debug, Default)]</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a></span><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>RectangleMutator</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a></span><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Mutator</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>RectangleMutator</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a></span><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>mutate</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>image</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Image</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>random</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Random</span>::<span class=n>default</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>rect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>get_random_rectangle</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>random</span><span class=p>,</span><span class=w> </span><span class=n>image</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=n>get_random</span><span class=p>(</span><span class=mi>0</span><span class=k>u8</span><span class=p>,</span><span class=w> </span><span class=mi>255</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=n>get_random</span><span class=p>(</span><span class=mi>0</span><span class=k>u8</span><span class=p>,</span><span class=w> </span><span class=mi>255</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=n>get_random</span><span class=p>(</span><span class=mi>0</span><span class=k>u8</span><span class=p>,</span><span class=w> </span><span class=mi>255</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a></span><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>image_width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>image</span><span class=p>.</span><span class=n>width</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a></span><span class=cl><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a></span><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>rect</span><span class=p>.</span><span class=n>y</span><span class=o>..</span><span class=p>(</span><span class=n>rect</span><span class=p>.</span><span class=n>height</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>rect</span><span class=p>.</span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a></span><span class=cl><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>rect</span><span class=p>.</span><span class=n>x</span><span class=o>..</span><span class=p>(</span><span class=n>rect</span><span class=p>.</span><span class=n>width</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>rect</span><span class=p>.</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a></span><span class=cl><span class=w>                </span><span class=kd>let</span><span class=w> </span><span class=n>pixel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>image</span><span class=p>[</span><span class=n>j</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>image_width</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a></span><span class=cl><span class=w>                </span><span class=n>pixel</span><span class=p>.</span><span class=n>r</span><span class=p>(</span><span class=n>r</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a></span><span class=cl><span class=w>                </span><span class=n>pixel</span><span class=p>.</span><span class=n>g</span><span class=p>(</span><span class=n>g</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a></span><span class=cl><span class=w>                </span><span class=n>pixel</span><span class=p>.</span><span class=n>b</span><span class=p>(</span><span class=n>b</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a></span><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a></span><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a></span><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=ln id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a></span><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The implementation is really simple. First we get a random rectangle <em>(using the helper function)</em>, then generate color
channels, and finally draw the shape. Drawing itself is done by two nested loops iterating over columns and rows of the
image. With the two indexes it references a specific pixel: <code>j * image_width + 1</code> and finally overrides it using the
color channels.</p><p>Cool, let&rsquo;s see what the program generates after 10 000 generations when initialized with
&ldquo;<a href=https://en.wikipedia.org/wiki/File:Mona_Lisa,_by_Leonardo_da_Vinci,_from_C2RMF_retouched.webp>Mona Lisa</a>&rdquo;.</p><figure class=img-thumbnail><img src=/blog/franklin/randomness-of-life/output_010000.png alt="Random noise" class=img-thumbnail loading=lazy><figcaption><h4>Mona Lisa (generation #10 000)</h4></figcaption></figure><p>Doesn&rsquo;t really looks like anything. &#x1f610;<br>Which isn&rsquo;t very surprising; the code did what it was suppose to do: it generated random rectangles on the white image.
Since we don&rsquo;t have any scoring logic yet (that&rsquo;s a topic for another article) the resulting image is composed of random
noise. We&rsquo;ll need to wait a bit longer to get an image that even remotely reflects &ldquo;Mona Lisa&rdquo;.</p><h3 id=throwing-dice-of-other-shapes class="my-8 md:my-12 flex items-center justify-center"><hr class="w-1/12 border-neutral shrink-0 hidden md:block"><a class="font-bold text-center w-full md:w-fit mx-4 !no-underline !link-neutral" href=#throwing-dice-of-other-shapes aria-label=Anchor>Throwing dice of other shapes</a><hr class="w-1/12 border-neutral shrink-0 hidden md:block"></h3><p>It&rsquo;d be nice to have mutators other than <code>RectangleMutator</code>, which are able to mutate images with different shapes, but
I&rsquo;m not going to cover them here. The reason is simple &ndash; they operate under the same rules: you need to define
boundaries first and then you need to draw the desired shape. I&rsquo;ve implemented two other mutators: <code>TriangleMutator</code> and
<code>CircleMutator</code>. Their sources can be found on
<a href=https://github.com/nathiss/franklin/tree/73aa8dada3e8c3cae9aff5e24637785268e3527a/src/mutators>github.com/nathiss/franklin</a>.</p><h2 id=afterword class="my-8 md:my-12 flex items-center justify-center"><hr class="w-1/12 border-neutral shrink-0 hidden md:block"><a class="font-bold text-center w-full md:w-fit mx-4 !no-underline !link-neutral" href=#afterword aria-label=Anchor>Afterword</a><hr class="w-1/12 border-neutral shrink-0 hidden md:block"></h2><p>You might&rsquo;ve noticed that the code examples of this article are not strictly bounded together, meaning you cannot just
copy them to have a working example. A bunch of things like: <code>Random</code> implementation, loading the original image,
mutation loop, and the whole <code>impl Image</code> block are missing. If you want to have a working solution it&rsquo;s
<a href=https://github.com/nathiss/franklin/tree/73aa8dada3e8c3cae9aff5e24637785268e3527a>github.com/nathiss/franklin</a>
<em>(locked down to the newest commit at the moment of writing &ndash; 73aa8da)</em>. The goal of this series is not to go through
every single line of code to build a working utility, but rather to present an idea. So, moving forward all future
articles from this series will also be done in that style.</p><figure class=img-thumbnail><img src=/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.webp alt="Randomness of Life" class=img-thumbnail loading=lazy><figcaption><p>Photo by <a href="https://unsplash.com/@sharonmccutcheon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Alexander Grey</a> on <a href="https://unsplash.com/photos/2eAkk5lIkC8?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p></figcaption></figure><p>Stay tuned &#x1f30a;</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Usually the generation is generated randomly. See
<a href=https://en.wikipedia.org/wiki/Genetic_algorithm#Initialization>Genetic_algorithm</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><code>Random</code> is a project-private utility class. Source can be found
<a href=https://github.com/nathiss/franklin/blob/73aa8dada3e8c3cae9aff5e24637785268e3527a/src/util/random.rs>github.com/nathiss/franklin</a>.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></main><div class="w-100 flex justify-center my-8"><hr class="md:w-1/4 w-1/2 border-neutral"></div><div class="alert alert-info text-left text-text flex flex-col items-start gap-0"><h6 class="text-info-content flex gap-1 items-center !my-0 !text-lg"><span class=notification-bell><svg class="size-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848.0 005.454-1.31A8.967 8.967.0 0118 9.75V9A6 6 0 006 9v.75a8.967 8.967.0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714.0a24.255 24.255.0 01-5.714.0m5.714.0a3 3 0 11-5.714.0"/></svg></span>Interested in my work?</h6><div class="collapsible-content w-full"><div class="mt-2 w-full text-base-content"><p class=text-base-content>Consider subscribing to the
<a href=https://madebyme.today/index.xml class="link link-primary" title="RSS Feed">RSS Feed</a> or
joining my mailing list:
<a href=https://groups.google.com/g/madebyme-notifications class="link link-primary">madebyme-notifications on Google Groups </a>.</p><hr class="my-3 border-neutral-content w-full"><p class="text-sm text-neutral-content"><b>Disclaimer:</b> Only group owner (i.e. me) can view e-mail addresses
of group members. I will not share your e-mail with any third-parties
&mdash; it will be used exclusively to notify you about new blog posts.</p></div></div></div><div class="join grid grid-cols-2 mt-4"><a class="join-item btn h-auto py-2 px-4" href=https://madebyme.today/blog/franklin/art-from-chaos/><div class="grid grid-rows-2 gap-2 items-start w-full text-left"><p class="text-sm uppercase font-extralight">« Previous</p><p class=text-sm>Art From Chaos</p></div></a><a class="join-item btn h-auto py-2 px-4" href=https://madebyme.today/blog/franklin/natural-selection-and-loss-functions/><div class="grid grid-rows-2 gap-2 items-end w-full text-right"><p class="text-sm uppercase font-extralight place-content-start">Next »</p><p class=text-sm>Natural Selection and Loss Functions</p></div></a></div><hr class="my-4 border-neutral opacity-25"><script>let theme=getTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"nathiss/nathiss.github.io","data-repo-id":"MDEwOlJlcG9zaXRvcnk4MDYyNjk2Ng==","data-category":"Announcements","data-category-id":"DIC_kwDOBM5FFs4CYJcb","data-mapping":"pathname","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":theme,"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t)),document.querySelector("article.entry").appendChild(giscusScript)</script></article></main><footer class="footer footer-center text-base-content p-4"><aside><p>Copyright &copy;
2023&ndash;2025
<span class=text-primary>Kamil</span>
Rusin
/
<a href=/privacy/ class="link link-primary">Privacy</a></p></aside></footer><div id=madebyme-consent-banner class="toast toast-end hidden w-full sm:w-auto min-w-0 sm:min-w-fit"><div class="card bg-base-100 shadow-xl max-w-lg border"><div class="card-body gap-4"><div class="flex justify-between"><h3 class=card-title>Cookies 🍪</h3><button id=close-consent-button class="btn btn-square btn-sm" aria-label=Close><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg></button></div><div class="markdown-body text-sm"><p>This website uses <a href=https://marketingplatform.google.com/about/analytics/>Google Analytics 4</a> to gather data about page views and <a href=https://giscus.app/>Giscus</a> to support article comments.</p><p>This website respects the <a href=https://en.wikipedia.org/wiki/Do_Not_Track>Do Not Track</a> header field. If you do not wish to be tracked by Google Analytics, then please
enable <a href=https://en.wikipedia.org/wiki/Do_Not_Track>Do Not Track</a> for this domain.</p><p>If you wish to know more about data gathered on this website, read <a href=https://madebyme.today/privacy/>About Tracking & Data Collection</a>.</p></div><button id=consent-button class="btn btn-primary text-wrap">I acknowledge, don't show me this again</button></div></div></div><div id=page-progressbar class="fixed top-0 left-0 w-0 h-1 bg-primary-500 dark:bg-darkmode-primary-500 rounded-e-md" role=progressbar aria-valuemin=0 aria-valuenow=0 aria-valuemax=100></div><script>updateThemeCheckboxStatus(),giscusSendMessage({setConfig:{theme:getTheme()}})</script><script>const consentBannerKey="madebyme-given-consent",consentBannerVersion="9b17d89527a0803c9ca685eace5d3ec887d77f4173ad86d2d064b78ebbeb7497";document.getElementById("close-consent-button").addEventListener("click",()=>{document.getElementById("madebyme-consent-banner").classList.add("hidden")}),document.getElementById("consent-button").addEventListener("click",()=>{localStorage.setItem(consentBannerKey,consentBannerVersion),document.getElementById("madebyme-consent-banner").classList.add("hidden")});const localBannerVersion=localStorage.getItem(consentBannerKey);localBannerVersion!==consentBannerVersion&&document.getElementById("madebyme-consent-banner").classList.remove("hidden")</script><script defer>const readingProgressBar={progressBar:document.getElementById("page-progressbar"),update:()=>{const t=document.documentElement.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,e=t/n*100;readingProgressBar.progressBar.setAttribute("aria-valuenow",Math.trunc(e)),readingProgressBar.progressBar.style.width=e+"%"}};document.addEventListener("scroll",readingProgressBar.update);const bodyResizeObserver=new ResizeObserver(e=>{readingProgressBar.update()});bodyResizeObserver.observe(document.body)</script><script type=application/ld+json>{"@context":"https://schema.org/","@type":"Webpage","mainContentOfPage":{"@context":"https://schema.org/","@type":"WebPageElement","cssSelector":"#site-main"},"primaryImageOfPage":"https://madebyme.today/blog/franklin/randomness-of-life/alexander-grey-2eAkk5lIkC8-unsplash.jpg"}</script><script type=application/ld+json>{"@context":"https://schema.org/","@type":"WebSite","name":"MadeByMe","alternateName":"MadeByMe","url":"https://madebyme.today/","description":"I'm Kamil; I work as a software engineer and this is a collection of all things I've been working on in my personal time.","disambiguatingDescription":"I'm Kamil; I work as a software engineer and this is a collection of all things I've been working on in my personal time.","isFamilyFriendly":"true","thumbnailUrl":"https://madebyme.today/favicons/favicon-180x180-box-light.png","image":"https://madebyme.today/favicons/favicon-180x180-box-light.png","inLanguage":"en-us","sameAs":["https://www.madebyme.today","https://www.madebyme.today/","https://madebyme.today","index.xml"],"author":{"@context":"https://schema.org/","@type":"Person","gender":"male","email":"kamil.jakub.rusin@gmail.com","givenName":"Kamil","familyName":"Rusin","name":"Kamil Rusin","jobTitle":"Software Engineer","nationality":{"@context":"https://schema.org/","@type":"Country","name":"PL"},"alumniOf":{"@context":"https://schema.org/","@type":"CollegeOrUniversity","url":"https://www.pk.edu.pl/","name":"The Cracow University of Technology"},"url":"https:\/\/madebyme.today\/"}}</script></body></html>
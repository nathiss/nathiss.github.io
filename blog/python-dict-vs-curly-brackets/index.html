<!doctype html><html lang=en data-bs-theme=light data-theme-mode=auto><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-CXYG0Q9PH0"></script><script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CXYG0Q9PH0",{anonymize_ip:!1})}</script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet type=text/css title=light href=https://madebyme.today/stylesheets/light.min.784a3c0273754da6540abae0dd478c0197aa301afe7e6d1a36302cdfae51f3156eae1a132a0d63410598d14f7bd348386c28c8fa7ebc60f8a50efd6f69076de5.css integrity="sha512-eEo8AnN1TaZUCrrg3UeMAZeqMBr+fm0aNjAs365R8xVurhoTKg1jQQWY0U9700g4bCjI+n68YPilDv1vaQdt5Q=="><link rel=stylesheet type=text/css href=https://madebyme.today/stylesheets/syntax/light.min.810ddf7ba809ef7e3ddd9dbb2ee588bb789f53e53137f694b70eefbc74bab584727b8c48404ba7efb1281f521f9819edbc45fa27fc66e9114f6d0ddde24b7705.css integrity="sha512-gQ3fe6gJ73493Z27LuWIu3ifU+UxN/aUtw7vvHS6tYRye4xIQEun77EoH1IfmBntvEX6J/xm6RFPbQ3d4kt3BQ=="><link rel=stylesheet type=text/css href=https://madebyme.today/stylesheets/syntax/dark.min.defb25c422b8b0f9d1efa4c19aec6e10c59e9f38de1c3c38d0d0569479d4eedfe1ea32dbb2b2096163cd12250e1e871f84dd0870c39b66b12c3c580291bf623a.css integrity="sha512-3vslxCK4sPnR76TBmuxuEMWenzjeHDw40NBWlHnU7t/h6jLbsrIJYWPNEiUOHocfhN0IcMObZrEsPFgCkb9iOg=="><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://madebyme.today/favicons/favicon-16x16-box-light.png><link rel=icon type=image/png sizes=32x32 href=https://madebyme.today/favicons/favicon-32x32-box-light.png><link rel=icon type=image/png sizes=64x64 href=https://madebyme.today/favicons/favicon-64x64-box-light.png><link rel=apple-touch-icon sizes=180x180 href=https://madebyme.today/favicons/favicon-180x180-box-light.png><link rel=canonical href=https://madebyme.today/blog/python-dict-vs-curly-brackets/><link rel=alternate type=application/rss+xml href=https://madebyme.today/index.xml title=MadeByMe><meta name=description content="Some time ago, during a code review, I had a discussion with a colleague of mine about preferring dict() over {} in
new Python code. They argued that dict() is more readable &mdash; and expresses intent more clearly &mdash; therefore should
be preferred. I wasn&rsquo;t convinced by that, but at that time I didn&rsquo;t have any counterarguments, so I passed.
Yet that made me wonder: what&rsquo;s the difference between the dict type and {} literal expression?"><meta name=author content="Kamil Rusin"><meta name=msapplication-TileColor content="#f5f5f5"><meta name=theme-color content="#f5f5f5"><meta name=twitter:dnt content="on"><meta name=title property="og:title" content="Performance Analysis of Python's `dict()` and `{}`"><meta property="og:description" content="Some time ago, during a code review, I had a discussion with a colleague of mine about preferring dict() over {} in
new Python code. They argued that dict() is more readable &mdash; and expresses intent more clearly &mdash; therefore should
be preferred. I wasn&rsquo;t convinced by that, but at that time I didn&rsquo;t have any counterarguments, so I passed.
Yet that made me wonder: what&rsquo;s the difference between the dict type and {} literal expression?"><meta property="og:type" content="article"><meta property="og:url" content="https://madebyme.today/blog/python-dict-vs-curly-brackets/"><meta name=image property="og:image" content="https://madebyme.today/polaris-1920x1080.webp"><meta name=image property="og:image:secure_url" content="https://madebyme.today/polaris-1920x1080.webp"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-01-22T19:34:37+01:00"><meta property="article:modified_time" content="2024-01-28T15:11:09+01:00"><meta property="article:author" content="Kamil Rusin"><meta property="og:site_name" content="MadeByMe"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://madebyme.today/polaris-1920x1080.webp"><meta name=twitter:title content="Performance Analysis of Python's `dict()` and `{}`"><meta name=twitter:description content="Some time ago, during a code review, I had a discussion with a colleague of mine about preferring dict() over {} in
new Python code. They argued that dict() is more readable &mdash; and expresses intent more clearly &mdash; therefore should
be preferred. I wasn&rsquo;t convinced by that, but at that time I didn&rsquo;t have any counterarguments, so I passed.
Yet that made me wonder: what&rsquo;s the difference between the dict type and {} literal expression?"><meta name=twitter:site content="@AreElectrons"><meta name=generator content="Hugo 0.121.2"><title>Performance Analysis of Python's `dict()` and `{}` - MadeByMe</title>
<script>const themeKey="madebyme-theme",giscusSendMessage=e=>{const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")},setTheme=e=>{e==="light"||e==="dark"?localStorage.setItem(themeKey,e):e==="auto"&&localStorage.removeItem(themeKey),reloadTheme()},themeToColor=e=>{if(e==="light")return"#f5f5f5";if(e==="dark")return"#212529";throw`Unknown theme: ${e}`},reloadTheme=()=>{let e=getStoredTheme(),t=e;e===null&&(e=getPreferredTheme(),t="auto"),document.documentElement.setAttribute("data-bs-theme",e),document.documentElement.setAttribute("data-theme-mode",t),giscusSendMessage({setConfig:{theme:e}});const n=themeToColor(e);document.querySelector('meta[name="theme-color"]').setAttribute("content",n),document.querySelector('meta[name="msapplication-TileColor"]').setAttribute("content",n)},getStoredTheme=()=>localStorage.getItem(themeKey),getPreferredTheme=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";reloadTheme(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{reloadTheme()})</script></head><body class="d-flex flex-column"><nav class="navbar navbar-expand-md"><div class="navbar-container container-md"><a class="navbar-brand user-select-none" href=https://madebyme.today/><svg width="32" height="32" class="brand-image" viewBox="0 0 8.4666662 8.4666669" xmlns="http://www.w3.org/2000/svg"><path d="M4.2333343.0 4.0431084 3.4779276 2.4846858 2.4846842l.9932436 1.5584221L0 4.2333336l3.4779294.1902267-.9932436 1.5583486L4.0431084 4.9887382l.1902259 3.4779285.1902278-3.4780026L5.9819059 5.9819089 4.9886657 4.4235603l3.478001-.1902267-3.478001-.1902273.9932402-1.5584221-1.5583438.9933168zm0 3.5578186.1224401.5530001.5529991.1225149-.5529991.1224402-.1224401.5530008L4.1108194 4.3557738 3.5578188 4.2333336 4.1108194 4.1108187z"/></svg><span class="fw-bold text-success fs-6">MadeByMe</span>
</a><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarMenu aria-controls=navbarMenu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMenu><ul class="navbar-nav ms-3 ms-md-auto mb-2 mb-md-0"><li><a href=https://madebyme.today/blog/ title=Blog class="nav-link hover-success">Blog</a></li><li><a href=https://madebyme.today/projects/ title=Projects class="nav-link hover-success">Projects</a></li><li><a href=https://madebyme.today/cv/ title=Resumé class="nav-link hover-success">Resumé</a></li><li class="d-flex align-items-center"><button id=theme-toggler class="nav-link d-flex align-items-center justify-content-left" title>
<span class="d-block d-md-none"></span></button></li></ul></div></div></nav><main class=site-main><div class=container><div class="row justify-content-center"><div class=generic-col><nav class="breadcrumb mt-2 mb-3"><script type=application/ld+json>{"@context":"https://schema.org/","@type":"BreadcrumbList","itemListOrder":"ItemListOrderAscending","itemListElement":[{"@context":"https://schema.org/","@type":"ListItem","position":1,"name":"MadeByMe","item":"https://madebyme.today/","url":"https://madebyme.today/blog/python-dict-vs-curly-brackets/"},{"@context":"https://schema.org/","@type":"ListItem","position":2,"name":"Blog","item":"https://madebyme.today/blog/","url":"https://madebyme.today/blog/python-dict-vs-curly-brackets/"},{"@context":"https://schema.org/","@type":"ListItem","position":3,"name":"Performance Analysis of Python's `dict()` and `{}`","item":"https://madebyme.today/blog/python-dict-vs-curly-brackets/","url":"https://madebyme.today/blog/python-dict-vs-curly-brackets/"}]}</script><a href=https://madebyme.today/ class="text-decoration-none text-reset hover-success">root</a>
<span class=no-select>»</span>
<a href=https://madebyme.today/blog/ class="text-decoration-none text-reset hover-success">Blog</a>
<span class=no-select>»</span>
<a href=https://madebyme.today/blog/python-dict-vs-curly-brackets/ class="text-decoration-none text-reset hover-success">Performance Analysis of Python&rsquo;s <code>dict()</code> and <code>{}</code></a></nav><article class=entry><script type=application/ld+json>{"@context":"https://schema.org/","@type":"BlogPosting","name":"Performance Analysis of Python's `dict()` and `{}`","headline":"Performance Analysis of Python's `dict()` and `{}` | MadeByMe","alternativeHeadline":"Performance Analysis of Python's `dict()` and `{}` | MadeByMe","url":"https://madebyme.today/blog/python-dict-vs-curly-brackets/","datePublished":"2024-01-22T19:34:37+01:00","inLanguage":"en-us","wordCount":2917,"isFamilyFriendly":"true","copyrightYear":"2024","copyrightHolder":{"@context":"https://schema.org/","@type":"Person","givenName":"Kamil","familyName":"Rusin","name":"Kamil Rusin"},"description":"Some time ago, during a code review, I had a discussion with a colleague of mine about preferring dict() over {} in new Python code. They argued that dict() is more readable \u0026mdash; and expresses intent more clearly \u0026mdash; therefore should be preferred. I wasn\u0026rsquo;t convinced by that, but at that time I didn\u0026rsquo;t have any counterarguments, so I passed.\nYet that made me wonder: what\u0026rsquo;s the difference between the dict type and {} literal expression?\n","publisher":{"@context":"https://schema.org/","@type":"Organization","name":"MadeByMe","url":"https://madebyme.today/"},"keywords":["Python","CPython","dictionaries"],"mainEntityOfPage":"true","articleBody":"Some time ago, during a code review, I had a discussion with a colleague of mine about preferring dict() over {} in new Python code. They argued that dict() is more readable \u0026mdash; and expresses intent more clearly \u0026mdash; therefore should be preferred. I wasn\u0026rsquo;t convinced by that, but at that time I didn\u0026rsquo;t have any counterarguments, so I passed.\nYet that made me wonder: what\u0026rsquo;s the difference between the dict type and {} literal expression?\nLet\u0026rsquo;s go down the rabbit hole.\nNote I\u0026rsquo;ll be using Python 3.12 for all code samples here. This is really important, as there are significant differences between recent minor Python versions. # Python\u0026rsquo;s dictionaries First, let\u0026rsquo;s check what\u0026rsquo;s the performance difference between the two methods. I\u0026rsquo;ll use the timeit module for that.\n1$ python -m timeit \u0026#34;dict()\u0026#34; 210000000 loops, best of 5: 40 nsec per loop 3$ python -m timeit \u0026#34;{}\u0026#34; 420000000 loops, best of 5: 19.6 nsec per loop On my MacBook M1 the difference is almost 2x. A non-trivial difference, especially knowing that both of these expressions produce the exact same object.\nWhere does the difference come from?\nBefore we get into that, we need to sidetrack a little bit and talk about what happens when you execute Python code. Python is an interpreted language \u0026mdash; it needs to have an interpreter. CPython is the most wildly used interpreter of Python; it\u0026rsquo;s a reference implementation, meaning that other interpreters use it to determine the \u0026ldquo;correct\u0026rdquo; behavior. If you\u0026rsquo;ve installed Python from a default distribution, you have CPython installed on your machine.\nInterestingly, CPython is both a compiler and an interpreter. When executing Python code it first compiles it into bytecode instructions and interprets them.\nTo better understand the performance difference between dist() and {} let\u0026rsquo;s compare the bytecode instructions they compile into. Python has a built-in module called dis which does exactly that.\n1\u0026gt;\u0026gt;\u0026gt; import dis 2\u0026gt;\u0026gt;\u0026gt; def a(): 3... return dict() 4... 5\u0026gt;\u0026gt;\u0026gt; def b(): 6... return {} 7... 8\u0026gt;\u0026gt;\u0026gt; dis.dis(a) 9 1 0 RESUME 0 10 11 2 2 LOAD_GLOBAL 1 (NULL + dict) 12 12 CALL 0 13 20 RETURN_VALUE 14\u0026gt;\u0026gt;\u0026gt; dis.dis(b) 15 1 0 RESUME 0 16 17 2 2 BUILD_MAP 0 18 4 RETURN_VALUE Although they produce the same end result these two expression, quite clearly, execute different code.\n# Bytecode instructions The output of dis.dis isn\u0026rsquo;t very hard to understand.\n1 (1) | (2) | (3) | (4) | (5) 2-----|-----------|-----------------------|-----|--------------- 3 1 | 0 | RESUME | 0 | 4 | | | | 5 2 | 2 | LOAD_GLOBAL | 1 | (NULL + dict) 6 | 12 | CALL | 0 | 7 | 20 | RETURN_VALUE | | Each column has a purpose:\nLine number in the source code. The address of the instruction \u0026mdash; byte index in the compiled bytecode. The bytecode name (opcode). Operation parameters. Human-readable interpretation of the operation parameters. Alright, equipped with this knowledge and by cross-referencing the opcode set we know that:\nRESUME \u0026mdash; does nothing. It performs internal tracking, debugging and optimization checks. LOAD_GLOBAL \u0026mdash; loads a global variable onto the stack. From the human-readable interpretation of the opcode parameters we know that it loads dict (ignore NULL for now). CALL \u0026mdash; calls a callable object with the number of arguments specified by argc \u0026mdash; in our case it\u0026rsquo;s zero. RETURN_VALUE \u0026mdash; returns with the last element from the stack to the caller. Compiling return {} yields one more opcode:\nBUILD_MAP \u0026mdash; pushes a new dictionary object onto the stack. Pops 2 * count items so that the dictionary holds count entries. Already we have a few obvious differences between the two cases. The {} expression builds a dictionary directly, while dict() delegates that to a callable object. Before that can even happen it first needs to load the global value (dict) onto the stack \u0026mdash; it actually does that every single time we call that function.\nWhy?\nBecause dict is not constant: it can be overwritten \u0026mdash; and therefore \u0026mdash; produce a different value.\n1\u0026gt;\u0026gt;\u0026gt; def a(): 2... return dict() 3... 4\u0026gt;\u0026gt;\u0026gt; dict = lambda: 42 5\u0026gt;\u0026gt;\u0026gt; 6\u0026gt;\u0026gt;\u0026gt; assert a() == 42 It can happen. This is why Python needs to generate this overhead of loading and calling a callable for every call of the function.\nOK, it all sound very neat. Calling a callable does create an overhead and it\u0026rsquo;s reasonable to assume that the difference we saw at the beginning of this post is a result of this overhead. However, are we sure that dict() internally calls the same code, as {} does? dict is a class and, luckily, the dis.dis function can compile classes to bytecode.\nExample 1import dis 2 3class Foo: 4 def bar(self): 5 return 42 6 7 def __str__(self): 8 return self.__class__.__name__ 9 10dis.dis(Foo) It prints out disassembly for all of the classes\u0026rsquo;s methods:\n1Disassembly of __str__: 2 8 0 RESUME 0 3 4 9 2 LOAD_FAST 0 (self) 5 4 LOAD_ATTR 0 (__class__) 6 24 LOAD_ATTR 2 (__name__) 7 44 RETURN_VALUE 8 9Disassembly of bar: 10 5 0 RESUME 0 11 12 6 2 RETURN_CONST 1 (42) Let\u0026rsquo;s try this for dict:\n1\u0026gt;\u0026gt;\u0026gt; dis.dis(dict) 2\u0026gt;\u0026gt;\u0026gt; \u0026hellip; it doesn\u0026rsquo;t print anything? Why?\nWell, the dis module isn\u0026rsquo;t very useful for internal types and dict is one of those types \u0026mdash; defined within the interpreter\u0026rsquo;s source code.\n# Getting lost in the CPython source code To tap into the forbidden magic, we need to clone the CPython repository first. We don\u0026rsquo;t need all the history, so let\u0026rsquo;s --depth 1 this.\n1git clone --depth 1 --branch v3.12.0 https://github.com/python/cpython.git 2# or 3git clone --depth 1 --branch v3.12.0 git@github.com:python/cpython.git Then we need to find what we\u0026rsquo;re actually looking for \u0026mdash; a place where opcode instructions are interpreted. After a cup of coffee and a lot of greps later we find the Python/bytecodes.c file. It consists of a single switch statement and it seems like all bytecode instruction are interpreted there.\n# The dict type Let\u0026rsquo;s tackle dict first. All internal types are defined as PyTypeObject objects and the dict type is defined in the dictobject.c file. It has a lot of attributes defined, but only two are of interest for us:\n1PyTypeObject PyDict_Type = { 2 PyVarObject_HEAD_INIT(\u0026amp;PyType_Type, 0) 3 \u0026#34;dict\u0026#34;, 4 sizeof(PyDictObject), 5 // ... 6 dict_init, /* tp_init */ 7 // ... 8 dict_new, /* tp_new */ 9 // ... 10}; The pair (dict_new and dict_init) will tell us what happens when someone creates a new dictionary.\nNote The constructor in Python is called __new__. It\u0026rsquo;s a static method that returns a new object of its type.\nThe initializer method is called __init__. It takes a newly created object and initializes its attributes. The __init__method is called after the __new__ method.\nThe dict_new function is defined here: dictobject.c#L3751.\n1static PyObject * 2dict_new(PyTypeObject*type, PyObject *args, PyObject*kwds) 3{ 4 assert(type != NULL); 5 assert(type-\u0026gt;tp_alloc != NULL); 6 // dict subclasses must implement the GC protocol 7 assert(_PyType_IS_GC(type)); 8 9 PyObject *self = type-\u0026gt;tp_alloc(type, 0); 10 if (self == NULL) { 11 return NULL; 12 } 13 PyDictObject *d = (PyDictObject *)self; 14 15 d-\u0026gt;ma_used = 0; 16 d-\u0026gt;ma_version_tag = DICT_NEXT_VERSION( 17 _PyInterpreterState_GET()); 18 dictkeys_incref(Py_EMPTY_KEYS); 19 d-\u0026gt;ma_keys = Py_EMPTY_KEYS; 20 d-\u0026gt;ma_values = NULL; 21 ASSERT_CONSISTENT(d); 22 23 // ... 24 25 return self; 26} We see that first, it allocates a new object via the provided allocator (9th line) and then sets some of its internal fields (15th, 19th, and 20th). Interestingly for us, it does not pre-allocate the dictionary\u0026rsquo;s internal memory (see marked lines). It might seems strange at first, but please remember: an object\u0026rsquo;s initialization \u0026mdash; like memory pre-allocation \u0026mdash; is not a responsibility of the __new__ method, that what the __init__ method is for.\nWith the new object in memory, the dict_init function can insert entries to it. The insertion logic is delegated to the dict_update_common function, which can be found here: dictobject.c#L2678.\n1static int 2dict_update_common(PyObject *self, PyObject *args, PyObject *kwds, 3 const char *methname) 4{ 5 PyObject *arg = NULL; 6 int result = 0; 7 8 if (!PyArg_UnpackTuple(args, methname, 0, 1, \u0026amp;arg)) { 9 result = -1; 10 } 11 else if (arg != NULL) { 12 result = dict_update_arg(self, arg); 13 } 14 15 if (result == 0 \u0026amp;\u0026amp; kwds != NULL) { 16 if (PyArg_ValidateKeywordArguments(kwds)) 17 result = PyDict_Merge(self, kwds, 1); 18 else 19 result = -1; 20 } 21 return result; 22} It updates the dictionary from both args and kwargs.\n# args \u0026amp; dict_update_arg For args it calls the dict_update_arg function.\n1static int 2dict_update_arg(PyObject *self, PyObject *arg) 3{ 4 if (PyDict_CheckExact(arg)) { 5 return PyDict_Merge(self, arg, 1); 6 } 7 PyObject *func; 8 if (_PyObject_LookupAttr(arg, \u0026amp;_Py_ID(keys), \u0026amp;func) \u0026lt; 0) { 9 return -1; 10 } 11 if (func != NULL) { 12 Py_DECREF(func); 13 return PyDict_Merge(self, arg, 1); 14 } 15 return PyDict_MergeFromSeq2(self, arg, 1); 16} The function checks if arg is a dictionary, if so it merges the two (PyDict_Merge), otherwise it adds new entries from a sequence of pairs (PyDict_MergeFromSeq2).\n# kwargs \u0026amp; PyDict_Merge The kwargs path ends in the same place \u0026mdash; PyDict_Merge. Let\u0026rsquo;s take a look.\nInternally, it delegates all logic to the dict_merge function.\n1static int 2dict_merge(PyInterpreterState *interp, PyObject *a, PyObject *b, int override) 3{ 4 PyDictObject *mp, *other; 5 6 assert(0 \u0026lt;= override \u0026amp;\u0026amp; override \u0026lt;= 2); 7 8 /* We accept for the argument either a concrete dictionary object, 9 * or an abstract \u0026#34;mapping\u0026#34; object. For the former, we can do 10 * things quite efficiently. For the latter, we only require that 11 * PyMapping_Keys() and PyObject_GetItem() be supported. 12 */ 13 if (a == NULL || !PyDict_Check(a) || b == NULL) { 14 PyErr_BadInternalCall(); 15 return -1; 16 } 17 mp = (PyDictObject*)a; 18 if (PyDict_Check(b) \u0026amp;\u0026amp; (Py_TYPE(b)-\u0026gt;tp_iter == (getiterfunc)dict_iter)) { 19 20 // ... 21 else { 22 /* Do it the generic, slower way */ 23 24 // ... 25 } 26 ASSERT_CONSISTENT(a); 27 return 0; 28} From the comment, we know that the function has been optimized for being called with another dictionary as a parameter. If the parameter is not a dictionary, then it\u0026rsquo;s a generic Mapping \u0026mdash; a container object that supports arbitrary key lookups.\n# The {} expression The literal expression should be easier to reason about. Let\u0026rsquo;s go back to the bytecode.c file and find mapping for the BUILD_MAP opcode.\n1inst(BUILD_MAP, (values[oparg*2] -- map)) { 2 map = _PyDict_FromItems( 3 values, 2, 4 values+1, 2, 5 oparg); 6 if (map == NULL) 7 goto error; 8 9 DECREF_INPUTS(); 10 ERROR_IF(map == NULL, error); 11} See sources here: bytecode.c#L1541.\nWe see that the dictionary is fully constructed and returned by _PyDict_FromItems. Let\u0026rsquo;s go there.\n1PyObject * 2_PyDict_FromItems(PyObject *const *keys, Py_ssize_t keys_offset, 3 PyObject *const *values, Py_ssize_t values_offset, 4 Py_ssize_t length) 5{ 6 bool unicode = true; 7 PyObject *const *ks = keys; 8 PyInterpreterState *interp = _PyInterpreterState_GET(); 9 10 for (Py_ssize_t i = 0; i \u0026lt; length; i++) { 11 if (!PyUnicode_CheckExact(*ks)) { 12 unicode = false; 13 break; 14 } 15 ks += keys_offset; 16 } 17 18 PyObject *dict = dict_new_presized(interp, length, unicode); 19 if (dict == NULL) { 20 return NULL; 21 } 22 23 ks = keys; 24 PyObject *const *vs = values; 25 26 for (Py_ssize_t i = 0; i \u0026lt; length; i++) { 27 PyObject *key = *ks; 28 PyObject *value = *vs; 29 if (PyDict_SetItem(dict, key, value) \u0026lt; 0) { 30 Py_DECREF(dict); 31 return NULL; 32 } 33 ks += keys_offset; 34 vs += values_offset; 35 } 36 37 return dict; 38} I\u0026rsquo;ve marked the most interesting line: in opposition to dict_new, it pre-allocates the dictionary, so it already has a capacity for all of its entries. After that it inserts key-value pairs one-by-one.\n# Conclusions To sum things up.\nWhen you do dict(a=1, b=2), Python needs to:\nallocate a new PyObject, construct a dict via the __new__ method, call its __init__ method, which internally calls PyDict_Merge, because kwargs is not dict, PyDict_Merge needs to use the slower method, which inserts entries one-by-one. Whereas doing {} causes Python to:\nconstruct a new pre-allocated dictionary, insert entries one-by-one. To be fair, unless you construct dictionaries in a loop, I don\u0026rsquo;t believe there\u0026rsquo;s a lot to gain performance-wise by switching from dict to {}. There\u0026rsquo;s one thing I\u0026rsquo;d like you to remember after reading this post:\ntl;dr The {} is always faster than dict. # Appendix Similar analysis can be done for lists, sets, and (possibly) tuples. However, this post is already too long, so I\u0026rsquo;ll drop all the other resources I\u0026rsquo;ve gathered here.\n# Lists 1$ python -m timeit \u0026#34;list((1, 2, \u0026#39;a\u0026#39;))\u0026#34; 25000000 loops, best of 5: 53.4 nsec per loop 3$ python -m timeit \u0026#34;[1, 2, \u0026#39;a\u0026#39;]\u0026#34; 410000000 loops, best of 5: 29.7 nsec per loop # list type The Python\u0026rsquo;s list type is defined in the listobject.c file:\n1PyTypeObject PyList_Type = { 2 // ... 3 (initproc)list___init__, /* tp_init */ 4 PyType_GenericAlloc, /* tp_alloc */ 5 PyType_GenericNew, /* tp_new */ 6 // ... 7} PyType_GenericNew does nothing \u0026mdash; it ignores args and kwargs, and return an object allocated by type-\u0026gt;typ_alloc. Source: https://github.com/python/cpython/blob/main/Objects/typeobject.c#L1768\nPyType_GenericAlloc allocated a new object and (if it\u0026rsquo;s garbage-collectable) marks it as \u0026ldquo;to-be-collected\u0026rdquo;.\nlist___init__ is a convenience wrapper around the list___init___impl function, which does the actual initialization. It does some basic pre-steps:\nfails if any kwarg has been passed, fails if args has more than 1 element, converts the first argument of args to an iterable. list___init___impl clears the list (if not empty) and extends it by the provided iterable (by calling the list_extend function).\nQuestion I think the two:\n1list((1, 2, 3)) 2 3_tmp = list() 4_tmp.extend((1, 2, 3)) are equivalent in every way (but the generated opcodes sequence) and are calling the same underlying C code.\n# [] literal expression Opcode BUILD_LIST uses the _PyList_FromArraySteal function to construct a list object and return it.\nNote _PyList_FromArraySteal is used since 3.12. See 3.12 changelog and gh-100146. Before 3.12, the opcode was repeatedly calling POP() to get items from the stack, and then inserting them into the list.\n1while (--oparg \u0026gt;= 0) { 2 PyObject *item = POP(); 3 PyList_SET_ITEM(list, oparg, item); 4} See change in gh-100146 PR.\nThe _PyList_FromArraySteal helper creates an empty list (if there are no items), or preallocates the list before inserting items to it.\n1PyObject **dst = list-\u0026gt;ob_item; 2memcpy(dst, src, n * sizeof(PyObject *)); # Sets Warning AFAIK there\u0026rsquo;s no way to construct a new set with a literal expression, hence the following analysis is performed for sets with two elements: 1 and 2. 1$ python -m timeit \u0026#34;set((1, 2))\u0026#34; 25000000 loops, best of 5: 82.6 nsec per loop 3$ python -m timeit \u0026#34;{1, 2}\u0026#34; 45000000 loops, best of 5: 45.5 nsec per loop # set type The Python\u0026rsquo;s set type is defined in the setobject.c file:\n1PyTypeObject PySet_Type = { 2 // ... 3 (initproc)set_init, /* tp_init */ 4 PyType_GenericAlloc, /* tp_alloc */ 5 set_new, /* tp_new */ 6 // ... 7} set_new uses the allocated to create a new empty set object. Internally it calls the make_new_set function.\nset_init performs some pre-steps:\nfails if any kwarg has been passed, fails if args has more then 1 element, converts the first argument of args to an iterable, if the set object has already been filled, then it clears it \u0026hellip; and calls the set_update_internal function, to insert values into the set object.\n# {1, 2} literal expression The opcode handler has no dedicated helpers. It constructs a new set (empty), and then iterates over all items from the stack and insets them one-by-one.\n1inst(BUILD_SET, (values[oparg] -- set)) { 2 set = PySet_New(NULL); 3 if (set == NULL) 4 GOTO_ERROR(error); 5 int err = 0; 6 for (int i = 0; i \u0026lt; oparg; i++) { 7 PyObject *item = values[i]; 8 if (err == 0) 9 err = PySet_Add(set, item); 10 Py_DECREF(item); 11 } 12 if (err != 0) { 13 Py_DECREF(set); 14 ERROR_IF(true, error); 15 } 16} Source: https://github.com/python/cpython/blob/main/Python/bytecodes.c#L1627.\nWarning Warning The generated bytecode is different if we add another argument to the literal expression: {1, 2, 3}. Then it becomes:\n1 2 BUILD_SET 0 2 4 LOAD_CONST 1 (frozenset({1, 2, 3})) 3 6 SET_UPDATE 1 4 8 RETURN_VALUE # Tuples This one\u0026rsquo;s tricky. Constructing a tuple with the tuple type requires an iterable. The easiest way of getting one it to create a tuple literal, which is obviously less efficient, than using a tuple literal syntax in the first place.\n1\u0026gt;\u0026gt;\u0026gt; import sys 2\u0026gt;\u0026gt;\u0026gt; sys.version_info 3sys.version_info(major=3, minor=12, micro=1, releaselevel=\u0026#39;final\u0026#39;, serial=0) 4\u0026gt;\u0026gt;\u0026gt; 5\u0026gt;\u0026gt;\u0026gt; def a(): 6... return tuple((1, 2, [])) 7\u0026gt;\u0026gt;\u0026gt; 8\u0026gt;\u0026gt;\u0026gt; def b(): 9... return (1, 2, []) 10\u0026gt;\u0026gt;\u0026gt; 11\u0026gt;\u0026gt;\u0026gt; import dis 12\u0026gt;\u0026gt;\u0026gt; 13\u0026gt;\u0026gt;\u0026gt; dis.dis(a) 14 1 0 RESUME 0 15 16 2 2 LOAD_GLOBAL 1 (NULL + tuple) 17 12 LOAD_CONST 1 (1) 18 14 LOAD_CONST 2 (2) 19 16 BUILD_LIST 0 20 18 BUILD_TUPLE 3 21 20 CALL 1 22 28 RETURN_VALUE 23\u0026gt;\u0026gt;\u0026gt; dis.dis(b) 24 1 0 RESUME 0 25 26 2 2 LOAD_CONST 1 (1) 27 4 LOAD_CONST 2 (2) 28 6 BUILD_LIST 0 29 8 BUILD_TUPLE 3 30 10 RETURN_VALUE It might not make much sense to include this example in the article.\n# tuple type The Python\u0026rsquo;s tuple type is defined in tupleobject.c. Interestingly, it has no tp_alloc, nor tp_init.\n1PyTypeObject PyTuple_Type = { 2 // ... 3 0, /* tp_init */ 4 0, /* tp_alloc */ 5 tuple_new, /* tp_new */ 6 // ... 7} The tuple_new function is responsible for allocating a new tuple object, with the items passed as a parameter.\n","author":{"@context":"https://schema.org/","@type":"Person","gender":"male","email":"kamil.jakub.rusin@gmail.com","givenName":"Kamil","familyName":"Rusin","name":"Kamil Rusin","jobTitle":"Software Engineer","nationality":{"@context":"https://schema.org/","@type":"Country","name":"PL"},"alumniOf":{"@context":"https://schema.org/","@type":"CollegeOrUniversity","url":"https://www.pk.edu.pl/","name":"The Cracow University of Technology"},"url":"https:\/\/madebyme.today\/"}}</script><script type=application/ld+json>{"@context":"https://schema.org/","@type":"WPHeader","@id":"#article-title","cssSelector":"#article-title"}</script><header><h1 id=article-title class="text-wrap-balance m-0 fs-2">Performance Analysis of Python&rsquo;s <code>dict()</code> and <code>{}</code></h1></header><footer class="entry-meta fw-light d-flex align-items-center flex-wrap"><time datetime=2024-01-22T19:34:37 class="d-flex align-items-center"><span>2024</span>
<span>01</span>
<span>22</span>
</time><span>14 min</span>
<span><span class=text-success>Kamil</span>
<span>Rusin</span></span></footer><aside class=table-of-contents-wrapper><div class=my-3><input id=toc-collapsible class=toggle type=checkbox>
<label for=toc-collapsible class="lbl-toggle fw-light">Table Of Contents</label><div class=collapsible-content><div class=content-inner><nav id=TableOfContents><ul><li><a href=#pythons-dictionaries>Python&rsquo;s dictionaries</a><ul><li><a href=#bytecode-instructions>Bytecode instructions</a></li><li><a href=#getting-lost-in-the-cpython-source-code>Getting lost in the CPython source code</a><ul><li><a href=#the-dict-type>The <code>dict</code> type</a><ul><li><a href=#args--dict_update_arg>args & <code>dict_update_arg</code></a></li><li><a href=#kwargs--pydict_merge>kwargs & <code>PyDict_Merge</code></a></li></ul></li><li><a href=#the--expression>The <code>{}</code> expression</a></li></ul></li></ul></li><li><a href=#conclusions>Conclusions</a></li><li><a href=#appendix>Appendix</a><ul><li><a href=#lists>Lists</a><ul><li><a href=#list-type><code>list</code> type</a></li><li><a href=#-literal-expression><code>[]</code> literal expression</a></li></ul></li><li><a href=#sets>Sets</a><ul><li><a href=#set-type><code>set</code> type</a></li><li><a href=#1-2-literal-expression><code>{1, 2}</code> literal expression</a></li></ul></li><li><a href=#tuples>Tuples</a><ul><li><a href=#tuple-type><code>tuple</code> type</a></li></ul></li></ul></li></ul></nav></div></div></div></aside><main class=main><p>Some time ago, during a code review, I had a discussion with a colleague of mine about preferring <code>dict()</code> over <code>{}</code> in
new Python code. They argued that <code>dict()</code> is more readable &mdash; and expresses intent more clearly &mdash; therefore should
be preferred. I wasn&rsquo;t convinced by that, but at that time I didn&rsquo;t have any counterarguments, so I passed.</p><p>Yet that made me wonder: what&rsquo;s the difference between the <code>dict</code> type and <code>{}</code> literal expression?</p><p>Let&rsquo;s go down the rabbit hole.</p><div class="alert alert-info"><h6 class=alert-heading><i class="bi bi-pencil me-2" aria-hidden=true></i>
Note</h6><p class=my-3>I&rsquo;ll be using <a href=https://www.python.org/downloads/release/python-3120/>Python 3.12</a> for all code samples here. This is <strong>really important</strong>, as there are
<a href=https://docs.python.org/3.12/whatsnew/changelog.html>significant differences</a> between recent minor Python versions.</p></div><h2 id=pythons-dictionaries><a href=#pythons-dictionaries aria-label=Anchor>#</a>
Python&rsquo;s dictionaries</h2><p>First, let&rsquo;s check what&rsquo;s the performance difference between the two methods. I&rsquo;ll use the <a href=https://docs.python.org/3.12/library/timeit.html><code>timeit</code></a>
module for that.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a></span><span class=cl>$ python -m timeit <span class=s2>&#34;dict()&#34;</span>
</span></span><span class=line><span class=ln id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a></span><span class=cl><span class=m>10000000</span> loops, best of 5: <span class=m>40</span> nsec per loop
</span></span><span class=line><span class=ln id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a></span><span class=cl>$ python -m timeit <span class=s2>&#34;{}&#34;</span>
</span></span><span class=line><span class=ln id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a></span><span class=cl><span class=m>20000000</span> loops, best of 5: 19.6 nsec per loop
</span></span></code></pre></div><p>On my MacBook M1 the difference is <strong>almost 2x</strong>. A non-trivial difference, especially knowing that both of these
expressions produce the exact same object.</p><p>Where does the difference come from?</p><p>Before we get into that, we need to sidetrack a little bit and talk about what happens when you execute Python code.
Python is an <a href=https://en.wikipedia.org/wiki/Scripting_language>interpreted language</a> &mdash; it needs to have an interpreter. <a href=https://github.com/python/cpython/tree/v3.12.0>CPython</a> is
the most wildly used interpreter of Python; it&rsquo;s a reference implementation, meaning that other interpreters use it to
determine the &ldquo;correct&rdquo; behavior. If you&rsquo;ve installed Python from a default distribution, you have CPython installed on
your machine.</p><p>Interestingly, CPython is both a compiler and an interpreter. When executing Python code it first compiles it into
<a href=https://docs.python.org/3.12/library/dis.html#python-bytecode-instructions>bytecode</a> instructions and interprets them.</p><p>To better understand the performance difference between <code>dist()</code> and <code>{}</code> let&rsquo;s compare the bytecode instructions they
compile into. Python has a built-in module called <a href=https://docs.python.org/3.12/library/dis.html>dis</a> which does exactly that.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kn>import</span> <span class=nn>dis</span>
</span></span><span class=line><span class=ln id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>a</span><span class=p>():</span>
</span></span><span class=line><span class=ln id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a></span><span class=cl><span class=o>...</span>   <span class=k>return</span> <span class=nb>dict</span><span class=p>()</span>
</span></span><span class=line><span class=ln id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a></span><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=ln id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>b</span><span class=p>():</span>
</span></span><span class=line><span class=ln id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a></span><span class=cl><span class=o>...</span>   <span class=k>return</span> <span class=p>{}</span>
</span></span><span class=line><span class=ln id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a></span><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=ln id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a></span><span class=cl>  <span class=mi>1</span>           <span class=mi>0</span> <span class=n>RESUME</span>                   <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a></span><span class=cl>  <span class=mi>2</span>           <span class=mi>2</span> <span class=n>LOAD_GLOBAL</span>              <span class=mi>1</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>+</span> <span class=nb>dict</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a></span><span class=cl>             <span class=mi>12</span> <span class=n>CALL</span>                     <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a></span><span class=cl>             <span class=mi>20</span> <span class=n>RETURN_VALUE</span>
</span></span><span class=line><span class=ln id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a></span><span class=cl>  <span class=mi>1</span>           <span class=mi>0</span> <span class=n>RESUME</span>                   <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a></span><span class=cl>  <span class=mi>2</span>           <span class=mi>2</span> <span class=n>BUILD_MAP</span>                <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a></span><span class=cl>              <span class=mi>4</span> <span class=n>RETURN_VALUE</span>
</span></span></code></pre></div><p>Although they produce the same end result these two expression, quite clearly, execute different code.</p><h3 id=bytecode-instructions><a href=#bytecode-instructions aria-label=Anchor>#</a>
Bytecode instructions</h3><p>The output of <code>dis.dis</code> isn&rsquo;t very hard to understand.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln id=hl-2-1><a class=lnlinks href=#hl-2-1>1</a></span><span class=cl> (1) |    (2)    |          (3)          | (4) |      (5)      
</span></span><span class=line><span class=ln id=hl-2-2><a class=lnlinks href=#hl-2-2>2</a></span><span class=cl>-----|-----------|-----------------------|-----|---------------
</span></span><span class=line><span class=ln id=hl-2-3><a class=lnlinks href=#hl-2-3>3</a></span><span class=cl>   1 |         0 | RESUME                | 0   |
</span></span><span class=line><span class=ln id=hl-2-4><a class=lnlinks href=#hl-2-4>4</a></span><span class=cl>     |           |                       |     |
</span></span><span class=line><span class=ln id=hl-2-5><a class=lnlinks href=#hl-2-5>5</a></span><span class=cl>   2 |         2 | LOAD_GLOBAL           | 1   | (NULL + dict)
</span></span><span class=line><span class=ln id=hl-2-6><a class=lnlinks href=#hl-2-6>6</a></span><span class=cl>     |        12 | CALL                  | 0   |
</span></span><span class=line><span class=ln id=hl-2-7><a class=lnlinks href=#hl-2-7>7</a></span><span class=cl>     |        20 | RETURN_VALUE          |     |
</span></span></code></pre></div><p>Each column has a purpose:</p><ol><li>Line number in the source code.</li><li>The address of the instruction &mdash; byte index in the compiled bytecode.</li><li>The bytecode name (opcode).</li><li>Operation parameters.</li><li>Human-readable interpretation of the operation parameters.</li></ol><p>Alright, equipped with this knowledge and by cross-referencing the <a href=https://docs.python.org/3.12/library/dis.html#python-bytecode-instructions>opcode set</a> we know that:</p><ol><li><a href=https://docs.python.org/3.12/library/dis.html#opcode-RESUME><code>RESUME</code></a> &mdash; does nothing. It performs internal tracking, debugging and optimization checks.</li><li><a href=https://docs.python.org/3.12/library/dis.html#opcode-LOAD_GLOBAL><code>LOAD_GLOBAL</code></a> &mdash; loads a global variable onto the stack. From the human-readable interpretation of the opcode
parameters we know that it loads <code>dict</code> (ignore <code>NULL</code> for now).</li><li><a href=https://docs.python.org/3.12/library/dis.html#opcode-CALL><code>CALL</code></a> &mdash; calls a callable object with the number of arguments specified by <code>argc</code> &mdash; in our case it&rsquo;s zero.</li><li><a href=https://docs.python.org/3.12/library/dis.html#opcode-RETURN_VALUE><code>RETURN_VALUE</code></a> &mdash; returns with the last element from the stack to the caller.</li></ol><p>Compiling <code>return {}</code> yields one more opcode:</p><ol start=5><li><a href=https://docs.python.org/3.12/library/dis.html#opcode-BUILD_MAP><code>BUILD_MAP</code></a> &mdash; pushes a new dictionary object onto the stack. Pops <code>2 * count</code> items so that the dictionary holds
count entries.</li></ol><p>Already we have a few obvious differences between the two cases. The <code>{}</code> expression builds a dictionary directly, while
<code>dict()</code> delegates that to a callable object. Before that can even happen it first needs to load the global value
(<code>dict</code>) onto the stack &mdash; it actually does that every single time we call that function.</p><p>Why?</p><p>Because <code>dict</code> is not constant: it can be overwritten &mdash; and therefore &mdash; produce a different value.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln id=hl-3-1><a class=lnlinks href=#hl-3-1>1</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>a</span><span class=p>():</span>
</span></span><span class=line><span class=ln id=hl-3-2><a class=lnlinks href=#hl-3-2>2</a></span><span class=cl><span class=o>...</span>   <span class=k>return</span> <span class=nb>dict</span><span class=p>()</span>
</span></span><span class=line><span class=ln id=hl-3-3><a class=lnlinks href=#hl-3-3>3</a></span><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=ln id=hl-3-4><a class=lnlinks href=#hl-3-4>4</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>dict</span> <span class=o>=</span> <span class=k>lambda</span><span class=p>:</span> <span class=mi>42</span>
</span></span><span class=line><span class=ln id=hl-3-5><a class=lnlinks href=#hl-3-5>5</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span>
</span></span><span class=line><span class=ln id=hl-3-6><a class=lnlinks href=#hl-3-6>6</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>assert</span> <span class=n>a</span><span class=p>()</span> <span class=o>==</span> <span class=mi>42</span>
</span></span></code></pre></div><p>It can happen. This is why Python needs to generate this overhead of loading and calling a callable for every call of
the function.</p><p>OK, it all sound very neat. Calling a callable does create an overhead and it&rsquo;s reasonable to assume that the difference
we saw at the beginning of this post is a result of this overhead. However, are we sure that <code>dict()</code> internally calls
the same code, as <code>{}</code> does? <code>dict</code> is a class and, luckily, the <a href=https://docs.python.org/3/library/dis.html#dis.dis><code>dis.dis</code></a> function can compile classes to bytecode.</p><div class="alert alert-info"><h6 class=alert-heading><i class="bi bi-pencil me-2" aria-hidden=true></i>
Example</h6><p class=my-3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a></span><span class=cl><span class=kn>import</span> <span class=nn>dis</span>
</span></span><span class=line><span class=ln id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a></span><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>:</span>
</span></span><span class=line><span class=ln id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a></span><span class=cl>    <span class=k>def</span> <span class=nf>bar</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a></span><span class=cl>        <span class=k>return</span> <span class=mi>42</span>
</span></span><span class=line><span class=ln id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a></span><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=ln id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a></span><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span>
</span></span><span class=line><span class=ln id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a></span><span class=cl><span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>Foo</span><span class=p>)</span>
</span></span></code></pre></div><p>It prints out disassembly for all of the classes&rsquo;s methods:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=ln id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a></span><span class=cl>Disassembly of __str__:
</span></span><span class=line><span class=ln id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a></span><span class=cl>  8           0 RESUME                   0
</span></span><span class=line><span class=ln id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a></span><span class=cl>  9           2 LOAD_FAST                0 (self)
</span></span><span class=line><span class=ln id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a></span><span class=cl>              4 LOAD_ATTR                0 (__class__)
</span></span><span class=line><span class=ln id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a></span><span class=cl>             24 LOAD_ATTR                2 (__name__)
</span></span><span class=line><span class=ln id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a></span><span class=cl>             44 RETURN_VALUE
</span></span><span class=line><span class=ln id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a></span><span class=cl>Disassembly of bar:
</span></span><span class=line><span class=ln id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a></span><span class=cl>  5           0 RESUME                   0
</span></span><span class=line><span class=ln id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a></span><span class=cl>  6           2 RETURN_CONST             1 (42)
</span></span></code></pre></div></p></div><p>Let&rsquo;s try this for <code>dict</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=nb>dict</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span>
</span></span></code></pre></div><p>&mldr; it doesn&rsquo;t print anything? Why?</p><p>Well, the <a href=https://docs.python.org/3.12/library/dis.html>dis</a> module isn&rsquo;t very useful for internal types and <code>dict</code> is one of those types &mdash; defined
within the interpreter&rsquo;s source code.</p><h3 id=getting-lost-in-the-cpython-source-code><a href=#getting-lost-in-the-cpython-source-code aria-label=Anchor>#</a>
Getting lost in the CPython source code</h3><p>To tap into the forbidden magic, we need to clone the <a href=https://github.com/python/cpython/tree/main>CPython repository</a> first. We don&rsquo;t need all the
history, so let&rsquo;s <a href=https://git-scm.com/docs/git-clone#Documentation/git-clone.txt---depthltdepthgt><code>--depth 1</code></a> this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a></span><span class=cl>git clone --depth <span class=m>1</span> --branch v3.12.0 https://github.com/python/cpython.git
</span></span><span class=line><span class=ln id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a></span><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=ln id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a></span><span class=cl>git clone --depth <span class=m>1</span> --branch v3.12.0 git@github.com:python/cpython.git
</span></span></code></pre></div><p>Then we need to find what we&rsquo;re actually looking for &mdash; a place where opcode instructions are interpreted. After a cup
of coffee and a lot of greps later we find the <a href=https://github.com/python/cpython/blob/v3.12.0/Python/bytecodes.c><code>Python/bytecodes.c</code></a> file. It consists of a single <code>switch</code>
statement and it seems like all bytecode instruction are interpreted there.</p><h4 id=the-dict-type><a href=#the-dict-type aria-label=Anchor>#</a>
The <code>dict</code> type</h4><p>Let&rsquo;s tackle <code>dict</code> first. All internal types are defined as <code>PyTypeObject</code> objects and the <code>dict</code> type is defined in
the <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L3839><code>dictobject.c</code></a> file. It has a lot of attributes defined, but only two are of interest
for us:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a></span><span class=cl><span class=n>PyTypeObject</span> <span class=n>PyDict_Type</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a></span><span class=cl>    <span class=nf>PyVarObject_HEAD_INIT</span><span class=p>(</span><span class=o>&amp;</span><span class=n>PyType_Type</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a></span><span class=cl>    <span class=s>&#34;dict&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=ln id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a></span><span class=cl>    <span class=k>sizeof</span><span class=p>(</span><span class=n>PyDictObject</span><span class=p>),</span>
</span></span><span class=line><span class=ln id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a></span><span class=cl><span class=c1></span>    <span class=n>dict_init</span><span class=p>,</span>                                  <span class=cm>/* tp_init */</span>
</span></span><span class=line><span class=ln id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a></span><span class=cl><span class=c1></span>    <span class=n>dict_new</span><span class=p>,</span>                                   <span class=cm>/* tp_new */</span>
</span></span><span class=line><span class=ln id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a></span><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></div><p>The pair (<code>dict_new</code> and <code>dict_init</code>) will tell us what happens when someone creates a new dictionary.</p><div class="alert alert-info"><h6 class=alert-heading><i class="bi bi-pencil me-2" aria-hidden=true></i>
Note</h6><p class=my-3><p>The constructor in Python is called <code>__new__</code>. It&rsquo;s a static method that returns a new object of its type.</p><p>The initializer method is called <code>__init__</code>. It takes a newly created object and initializes its attributes. The
<code>__init__</code>method is called after the <code>__new__</code> method.</p></p></div><p>The <code>dict_new</code> function is defined here: <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L3751>dictobject.c#L3751</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a></span><span class=cl><span class=k>static</span> <span class=n>PyObject</span> <span class=o>*</span>
</span></span><span class=line><span class=ln id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a></span><span class=cl><span class=nf>dict_new</span><span class=p>(</span><span class=n>PyTypeObject</span><span class=o>*</span><span class=n>type</span><span class=p>,</span> <span class=n>PyObject</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=n>PyObject</span><span class=o>*</span><span class=n>kwds</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a></span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a></span><span class=cl>    <span class=nf>assert</span><span class=p>(</span><span class=n>type</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a></span><span class=cl>    <span class=nf>assert</span><span class=p>(</span><span class=n>type</span><span class=o>-&gt;</span><span class=n>tp_alloc</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a></span><span class=cl>    <span class=c1>// dict subclasses must implement the GC protocol
</span></span></span><span class=line><span class=ln id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a></span><span class=cl><span class=c1></span>    <span class=nf>assert</span><span class=p>(</span><span class=nf>_PyType_IS_GC</span><span class=p>(</span><span class=n>type</span><span class=p>));</span>
</span></span><span class=line><span class=ln id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a></span><span class=cl>    <span class=n>PyObject</span> <span class=o>*</span><span class=n>self</span> <span class=o>=</span> <span class=n>type</span><span class=o>-&gt;</span><span class=nf>tp_alloc</span><span class=p>(</span><span class=n>type</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>self</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a></span><span class=cl>        <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a></span><span class=cl>    <span class=n>PyDictObject</span> <span class=o>*</span><span class=n>d</span> <span class=o>=</span> <span class=p>(</span><span class=n>PyDictObject</span> <span class=o>*</span><span class=p>)</span><span class=n>self</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a></span><span class=cl>
</span></span><span class="line hl"><span class=ln id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a></span><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>ma_used</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a></span><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>ma_version_tag</span> <span class=o>=</span> <span class=nf>DICT_NEXT_VERSION</span><span class=p>(</span>
</span></span><span class=line><span class=ln id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a></span><span class=cl>            <span class=nf>_PyInterpreterState_GET</span><span class=p>());</span>
</span></span><span class=line><span class=ln id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a></span><span class=cl>    <span class=nf>dictkeys_incref</span><span class=p>(</span><span class=n>Py_EMPTY_KEYS</span><span class=p>);</span>
</span></span><span class="line hl"><span class=ln id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a></span><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>ma_keys</span> <span class=o>=</span> <span class=n>Py_EMPTY_KEYS</span><span class=p>;</span>
</span></span><span class="line hl"><span class=ln id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a></span><span class=cl>    <span class=n>d</span><span class=o>-&gt;</span><span class=n>ma_values</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a></span><span class=cl>    <span class=nf>ASSERT_CONSISTENT</span><span class=p>(</span><span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a></span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln id=hl-7-25><a class=lnlinks href=#hl-7-25>25</a></span><span class=cl>    <span class=k>return</span> <span class=n>self</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-7-26><a class=lnlinks href=#hl-7-26>26</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We see that first, it allocates a new object via the provided allocator (9<sup>th</sup> line) and then sets
some of its internal fields (15<sup>th</sup>, 19<sup>th</sup>, and 20<sup>th</sup>).
Interestingly for us, it <strong>does not</strong> pre-allocate the dictionary&rsquo;s internal memory (see marked lines). It might seems
strange at first, but please remember: an object&rsquo;s initialization &mdash; like memory pre-allocation &mdash; is not a
responsibility of the <code>__new__</code> method, that what the <code>__init__</code> method is for.</p><p>With the new object in memory, the <code>dict_init</code> function can insert entries to it. The insertion logic is delegated to
the <code>dict_update_common</code> function, which can be found here: <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L2678>dictobject.c#L2678</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-8-1><a class=lnlinks href=#hl-8-1> 1</a></span><span class=cl><span class=k>static</span> <span class=kt>int</span>
</span></span><span class=line><span class=ln id=hl-8-2><a class=lnlinks href=#hl-8-2> 2</a></span><span class=cl><span class=nf>dict_update_common</span><span class=p>(</span><span class=n>PyObject</span> <span class=o>*</span><span class=n>self</span><span class=p>,</span> <span class=n>PyObject</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=n>PyObject</span> <span class=o>*</span><span class=n>kwds</span><span class=p>,</span>
</span></span><span class=line><span class=ln id=hl-8-3><a class=lnlinks href=#hl-8-3> 3</a></span><span class=cl>                   <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>methname</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-8-4><a class=lnlinks href=#hl-8-4> 4</a></span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-8-5><a class=lnlinks href=#hl-8-5> 5</a></span><span class=cl>    <span class=n>PyObject</span> <span class=o>*</span><span class=n>arg</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-8-6><a class=lnlinks href=#hl-8-6> 6</a></span><span class=cl>    <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-8-7><a class=lnlinks href=#hl-8-7> 7</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-8-8><a class=lnlinks href=#hl-8-8> 8</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>PyArg_UnpackTuple</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>methname</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>arg</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-8-9><a class=lnlinks href=#hl-8-9> 9</a></span><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-8-10><a class=lnlinks href=#hl-8-10>10</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-8-11><a class=lnlinks href=#hl-8-11>11</a></span><span class=cl>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>arg</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=ln id=hl-8-12><a class=lnlinks href=#hl-8-12>12</a></span><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=nf>dict_update_arg</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>arg</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-8-13><a class=lnlinks href=#hl-8-13>13</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-8-14><a class=lnlinks href=#hl-8-14>14</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-8-15><a class=lnlinks href=#hl-8-15>15</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>result</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>kwds</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-8-16><a class=lnlinks href=#hl-8-16>16</a></span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>PyArg_ValidateKeywordArguments</span><span class=p>(</span><span class=n>kwds</span><span class=p>))</span>
</span></span><span class="line hl"><span class=ln id=hl-8-17><a class=lnlinks href=#hl-8-17>17</a></span><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=nf>PyDict_Merge</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>kwds</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-8-18><a class=lnlinks href=#hl-8-18>18</a></span><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=ln id=hl-8-19><a class=lnlinks href=#hl-8-19>19</a></span><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-8-20><a class=lnlinks href=#hl-8-20>20</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-8-21><a class=lnlinks href=#hl-8-21>21</a></span><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-8-22><a class=lnlinks href=#hl-8-22>22</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It updates the dictionary from both args and kwargs.</p><h5 id=args--dict_update_arg><a href=#args--dict_update_arg aria-label=Anchor>#</a>
args & <code>dict_update_arg</code></h5><p>For <code>args</code> it calls the <code>dict_update_arg</code> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-9-1><a class=lnlinks href=#hl-9-1> 1</a></span><span class=cl><span class=k>static</span> <span class=kt>int</span>
</span></span><span class=line><span class=ln id=hl-9-2><a class=lnlinks href=#hl-9-2> 2</a></span><span class=cl><span class=nf>dict_update_arg</span><span class=p>(</span><span class=n>PyObject</span> <span class=o>*</span><span class=n>self</span><span class=p>,</span> <span class=n>PyObject</span> <span class=o>*</span><span class=n>arg</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-9-3><a class=lnlinks href=#hl-9-3> 3</a></span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-9-4><a class=lnlinks href=#hl-9-4> 4</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>PyDict_CheckExact</span><span class=p>(</span><span class=n>arg</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-9-5><a class=lnlinks href=#hl-9-5> 5</a></span><span class=cl>        <span class=k>return</span> <span class=nf>PyDict_Merge</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>arg</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-9-6><a class=lnlinks href=#hl-9-6> 6</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-9-7><a class=lnlinks href=#hl-9-7> 7</a></span><span class=cl>    <span class=n>PyObject</span> <span class=o>*</span><span class=n>func</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-9-8><a class=lnlinks href=#hl-9-8> 8</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>_PyObject_LookupAttr</span><span class=p>(</span><span class=n>arg</span><span class=p>,</span> <span class=o>&amp;</span><span class=nf>_Py_ID</span><span class=p>(</span><span class=n>keys</span><span class=p>),</span> <span class=o>&amp;</span><span class=n>func</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-9-9><a class=lnlinks href=#hl-9-9> 9</a></span><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-9-10><a class=lnlinks href=#hl-9-10>10</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-9-11><a class=lnlinks href=#hl-9-11>11</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>func</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-9-12><a class=lnlinks href=#hl-9-12>12</a></span><span class=cl>        <span class=nf>Py_DECREF</span><span class=p>(</span><span class=n>func</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-9-13><a class=lnlinks href=#hl-9-13>13</a></span><span class=cl>        <span class=k>return</span> <span class=nf>PyDict_Merge</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>arg</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-9-14><a class=lnlinks href=#hl-9-14>14</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-9-15><a class=lnlinks href=#hl-9-15>15</a></span><span class=cl>    <span class=k>return</span> <span class=nf>PyDict_MergeFromSeq2</span><span class=p>(</span><span class=n>self</span><span class=p>,</span> <span class=n>arg</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-9-16><a class=lnlinks href=#hl-9-16>16</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The function checks if <code>arg</code> is a dictionary, if so it merges the two (<a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L2988><code>PyDict_Merge</code></a>), otherwise it adds new entries
from a sequence of pairs (<a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L2722><code>PyDict_MergeFromSeq2</code></a>).</p><h5 id=kwargs--pydict_merge><a href=#kwargs--pydict_merge aria-label=Anchor>#</a>
kwargs & <code>PyDict_Merge</code></h5><p>The <code>kwargs</code> path ends in the same place &mdash; <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L2988><code>PyDict_Merge</code></a>. Let&rsquo;s take a look.</p><p>Internally, it delegates all logic to the <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L2807><code>dict_merge</code></a> function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a></span><span class=cl><span class=k>static</span> <span class=kt>int</span>
</span></span><span class=line><span class=ln id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a></span><span class=cl><span class=nf>dict_merge</span><span class=p>(</span><span class=n>PyInterpreterState</span> <span class=o>*</span><span class=n>interp</span><span class=p>,</span> <span class=n>PyObject</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=n>PyObject</span> <span class=o>*</span><span class=n>b</span><span class=p>,</span> <span class=kt>int</span> <span class=n>override</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a></span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a></span><span class=cl>    <span class=n>PyDictObject</span> <span class=o>*</span><span class=n>mp</span><span class=p>,</span> <span class=o>*</span><span class=n>other</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a></span><span class=cl>    <span class=nf>assert</span><span class=p>(</span><span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>override</span> <span class=o>&amp;&amp;</span> <span class=n>override</span> <span class=o>&lt;=</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a></span><span class=cl>    <span class=cm>/* We accept for the argument either a concrete dictionary object,
</span></span></span><span class=line><span class=ln id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a></span><span class=cl><span class=cm>     * or an abstract &#34;mapping&#34; object.  For the former, we can do
</span></span></span><span class=line><span class=ln id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a></span><span class=cl><span class=cm>     * things quite efficiently.  For the latter, we only require that
</span></span></span><span class=line><span class=ln id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a></span><span class=cl><span class=cm>     * PyMapping_Keys() and PyObject_GetItem() be supported.
</span></span></span><span class=line><span class=ln id=hl-10-12><a class=lnlinks href=#hl-10-12>12</a></span><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=ln id=hl-10-13><a class=lnlinks href=#hl-10-13>13</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=nb>NULL</span> <span class=o>||</span> <span class=o>!</span><span class=nf>PyDict_Check</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>||</span> <span class=n>b</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-10-14><a class=lnlinks href=#hl-10-14>14</a></span><span class=cl>        <span class=nf>PyErr_BadInternalCall</span><span class=p>();</span>
</span></span><span class=line><span class=ln id=hl-10-15><a class=lnlinks href=#hl-10-15>15</a></span><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-10-16><a class=lnlinks href=#hl-10-16>16</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-10-17><a class=lnlinks href=#hl-10-17>17</a></span><span class=cl>    <span class=n>mp</span> <span class=o>=</span> <span class=p>(</span><span class=n>PyDictObject</span><span class=o>*</span><span class=p>)</span><span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-10-18><a class=lnlinks href=#hl-10-18>18</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>PyDict_Check</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nf>Py_TYPE</span><span class=p>(</span><span class=n>b</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>tp_iter</span> <span class=o>==</span> <span class=p>(</span><span class=n>getiterfunc</span><span class=p>)</span><span class=n>dict_iter</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-10-19><a class=lnlinks href=#hl-10-19>19</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-10-20><a class=lnlinks href=#hl-10-20>20</a></span><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-10-21><a class=lnlinks href=#hl-10-21>21</a></span><span class=cl><span class=c1></span>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-10-22><a class=lnlinks href=#hl-10-22>22</a></span><span class=cl>        <span class=cm>/* Do it the generic, slower way */</span>
</span></span><span class=line><span class=ln id=hl-10-23><a class=lnlinks href=#hl-10-23>23</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-10-24><a class=lnlinks href=#hl-10-24>24</a></span><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-10-25><a class=lnlinks href=#hl-10-25>25</a></span><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-10-26><a class=lnlinks href=#hl-10-26>26</a></span><span class=cl>    <span class=nf>ASSERT_CONSISTENT</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-10-27><a class=lnlinks href=#hl-10-27>27</a></span><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-10-28><a class=lnlinks href=#hl-10-28>28</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>From the comment, we know that the function has been optimized for being called with another dictionary as a parameter.
If the parameter is not a dictionary, then it&rsquo;s a generic <a href=https://docs.python.org/3.12/library/collections.abc.html#collections.abc.Mapping><code>Mapping</code></a> &mdash; a container object that supports arbitrary key
lookups.</p><h4 id=the--expression><a href=#the--expression aria-label=Anchor>#</a>
The <code>{}</code> expression</h4><p>The literal expression should be easier to reason about. Let&rsquo;s go back to the <a href=https://github.com/python/cpython/blob/v3.12.0/Python/bytecodes.c>bytecode.c</a> file and find mapping for the
<code>BUILD_MAP</code> opcode.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-11-1><a class=lnlinks href=#hl-11-1> 1</a></span><span class=cl><span class=nf>inst</span><span class=p>(</span><span class=n>BUILD_MAP</span><span class=p>,</span> <span class=p>(</span><span class=n>values</span><span class=p>[</span><span class=n>oparg</span><span class=o>*</span><span class=mi>2</span><span class=p>]</span> <span class=o>--</span> <span class=n>map</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-11-2><a class=lnlinks href=#hl-11-2> 2</a></span><span class=cl>    <span class=n>map</span> <span class=o>=</span> <span class=nf>_PyDict_FromItems</span><span class=p>(</span>
</span></span><span class=line><span class=ln id=hl-11-3><a class=lnlinks href=#hl-11-3> 3</a></span><span class=cl>            <span class=n>values</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=ln id=hl-11-4><a class=lnlinks href=#hl-11-4> 4</a></span><span class=cl>            <span class=n>values</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=ln id=hl-11-5><a class=lnlinks href=#hl-11-5> 5</a></span><span class=cl>            <span class=n>oparg</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-11-6><a class=lnlinks href=#hl-11-6> 6</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>map</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-11-7><a class=lnlinks href=#hl-11-7> 7</a></span><span class=cl>        <span class=k>goto</span> <span class=n>error</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-11-8><a class=lnlinks href=#hl-11-8> 8</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-11-9><a class=lnlinks href=#hl-11-9> 9</a></span><span class=cl>    <span class=nf>DECREF_INPUTS</span><span class=p>();</span>
</span></span><span class=line><span class=ln id=hl-11-10><a class=lnlinks href=#hl-11-10>10</a></span><span class=cl>    <span class=nf>ERROR_IF</span><span class=p>(</span><span class=n>map</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>error</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-11-11><a class=lnlinks href=#hl-11-11>11</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><em>See sources here: <a href=https://github.com/python/cpython/blob/v3.12.0/Python/bytecodes.c#L1541>bytecode.c#L1541</a>.</em></p><p>We see that the dictionary is fully constructed and returned by <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L1616><code>_PyDict_FromItems</code></a>. Let&rsquo;s go there.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-12-1><a class=lnlinks href=#hl-12-1> 1</a></span><span class=cl><span class=n>PyObject</span> <span class=o>*</span>
</span></span><span class=line><span class=ln id=hl-12-2><a class=lnlinks href=#hl-12-2> 2</a></span><span class=cl><span class=nf>_PyDict_FromItems</span><span class=p>(</span><span class=n>PyObject</span> <span class=o>*</span><span class=k>const</span> <span class=o>*</span><span class=n>keys</span><span class=p>,</span> <span class=n>Py_ssize_t</span> <span class=n>keys_offset</span><span class=p>,</span>
</span></span><span class=line><span class=ln id=hl-12-3><a class=lnlinks href=#hl-12-3> 3</a></span><span class=cl>                  <span class=n>PyObject</span> <span class=o>*</span><span class=k>const</span> <span class=o>*</span><span class=n>values</span><span class=p>,</span> <span class=n>Py_ssize_t</span> <span class=n>values_offset</span><span class=p>,</span>
</span></span><span class=line><span class=ln id=hl-12-4><a class=lnlinks href=#hl-12-4> 4</a></span><span class=cl>                  <span class=n>Py_ssize_t</span> <span class=n>length</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-12-5><a class=lnlinks href=#hl-12-5> 5</a></span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-12-6><a class=lnlinks href=#hl-12-6> 6</a></span><span class=cl>    <span class=kt>bool</span> <span class=n>unicode</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-7><a class=lnlinks href=#hl-12-7> 7</a></span><span class=cl>    <span class=n>PyObject</span> <span class=o>*</span><span class=k>const</span> <span class=o>*</span><span class=n>ks</span> <span class=o>=</span> <span class=n>keys</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-8><a class=lnlinks href=#hl-12-8> 8</a></span><span class=cl>    <span class=n>PyInterpreterState</span> <span class=o>*</span><span class=n>interp</span> <span class=o>=</span> <span class=nf>_PyInterpreterState_GET</span><span class=p>();</span>
</span></span><span class=line><span class=ln id=hl-12-9><a class=lnlinks href=#hl-12-9> 9</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-12-10><a class=lnlinks href=#hl-12-10>10</a></span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>Py_ssize_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-12-11><a class=lnlinks href=#hl-12-11>11</a></span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>PyUnicode_CheckExact</span><span class=p>(</span><span class=o>*</span><span class=n>ks</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-12-12><a class=lnlinks href=#hl-12-12>12</a></span><span class=cl>            <span class=n>unicode</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-13><a class=lnlinks href=#hl-12-13>13</a></span><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-14><a class=lnlinks href=#hl-12-14>14</a></span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-12-15><a class=lnlinks href=#hl-12-15>15</a></span><span class=cl>        <span class=n>ks</span> <span class=o>+=</span> <span class=n>keys_offset</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-16><a class=lnlinks href=#hl-12-16>16</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-12-17><a class=lnlinks href=#hl-12-17>17</a></span><span class=cl>
</span></span><span class="line hl"><span class=ln id=hl-12-18><a class=lnlinks href=#hl-12-18>18</a></span><span class=cl>    <span class=n>PyObject</span> <span class=o>*</span><span class=n>dict</span> <span class=o>=</span> <span class=nf>dict_new_presized</span><span class=p>(</span><span class=n>interp</span><span class=p>,</span> <span class=n>length</span><span class=p>,</span> <span class=n>unicode</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-12-19><a class=lnlinks href=#hl-12-19>19</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>dict</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-12-20><a class=lnlinks href=#hl-12-20>20</a></span><span class=cl>        <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-21><a class=lnlinks href=#hl-12-21>21</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-12-22><a class=lnlinks href=#hl-12-22>22</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-12-23><a class=lnlinks href=#hl-12-23>23</a></span><span class=cl>    <span class=n>ks</span> <span class=o>=</span> <span class=n>keys</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-24><a class=lnlinks href=#hl-12-24>24</a></span><span class=cl>    <span class=n>PyObject</span> <span class=o>*</span><span class=k>const</span> <span class=o>*</span><span class=n>vs</span> <span class=o>=</span> <span class=n>values</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-25><a class=lnlinks href=#hl-12-25>25</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-12-26><a class=lnlinks href=#hl-12-26>26</a></span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>Py_ssize_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-12-27><a class=lnlinks href=#hl-12-27>27</a></span><span class=cl>        <span class=n>PyObject</span> <span class=o>*</span><span class=n>key</span> <span class=o>=</span> <span class=o>*</span><span class=n>ks</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-28><a class=lnlinks href=#hl-12-28>28</a></span><span class=cl>        <span class=n>PyObject</span> <span class=o>*</span><span class=n>value</span> <span class=o>=</span> <span class=o>*</span><span class=n>vs</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-29><a class=lnlinks href=#hl-12-29>29</a></span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>PyDict_SetItem</span><span class=p>(</span><span class=n>dict</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-12-30><a class=lnlinks href=#hl-12-30>30</a></span><span class=cl>            <span class=nf>Py_DECREF</span><span class=p>(</span><span class=n>dict</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-12-31><a class=lnlinks href=#hl-12-31>31</a></span><span class=cl>            <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-32><a class=lnlinks href=#hl-12-32>32</a></span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-12-33><a class=lnlinks href=#hl-12-33>33</a></span><span class=cl>        <span class=n>ks</span> <span class=o>+=</span> <span class=n>keys_offset</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-34><a class=lnlinks href=#hl-12-34>34</a></span><span class=cl>        <span class=n>vs</span> <span class=o>+=</span> <span class=n>values_offset</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-35><a class=lnlinks href=#hl-12-35>35</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-12-36><a class=lnlinks href=#hl-12-36>36</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-12-37><a class=lnlinks href=#hl-12-37>37</a></span><span class=cl>    <span class=k>return</span> <span class=n>dict</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-12-38><a class=lnlinks href=#hl-12-38>38</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>I&rsquo;ve marked the most interesting line: in opposition to <code>dict_new</code>, it <strong>pre-allocates</strong> the dictionary, so it already
has a capacity for all of its entries. After that it inserts key-value pairs one-by-one.</p><h2 id=conclusions><a href=#conclusions aria-label=Anchor>#</a>
Conclusions</h2><p>To sum things up.</p><p>When you do <code>dict(a=1, b=2)</code>, Python needs to:</p><ul><li>allocate a new <code>PyObject</code>,</li><li>construct a <code>dict</code> via the <code>__new__</code> method,</li><li>call its <code>__init__</code> method, which internally calls <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L2988><code>PyDict_Merge</code></a>,</li><li>because <code>kwargs</code> is not <code>dict</code>, <a href=https://github.com/python/cpython/blob/v3.12.0/Objects/dictobject.c#L2988><code>PyDict_Merge</code></a> needs to use the slower method, which inserts entries one-by-one.</li></ul><p>Whereas doing <code>{}</code> causes Python to:</p><ul><li>construct a new <strong>pre-allocated</strong> dictionary,</li><li>insert entries one-by-one.</li></ul><p>To be fair, unless you construct dictionaries in a loop, I don&rsquo;t believe there&rsquo;s a lot to gain performance-wise by
switching from <code>dict</code> to <code>{}</code>. There&rsquo;s one thing I&rsquo;d like you to remember after reading this post:</p><div class="alert alert-info"><h6 class=alert-heading><i class="bi bi-clipboard2-fill me-2" aria-hidden=true></i>
tl;dr</h6><p class=my-3>The <code>{}</code> is always faster than <code>dict</code>.</p></div><h2 id=appendix><a href=#appendix aria-label=Anchor>#</a>
Appendix</h2><p>Similar analysis can be done for lists, sets, and (<em>possibly</em>) tuples. However, this post is already too long, so I&rsquo;ll
drop all the other resources I&rsquo;ve gathered here.</p><h3 id=lists><a href=#lists aria-label=Anchor>#</a>
Lists</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a></span><span class=cl>$ python -m timeit <span class=s2>&#34;list((1, 2, &#39;a&#39;))&#34;</span>
</span></span><span class=line><span class=ln id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a></span><span class=cl><span class=m>5000000</span> loops, best of 5: 53.4 nsec per loop
</span></span><span class=line><span class=ln id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a></span><span class=cl>$ python -m timeit <span class=s2>&#34;[1, 2, &#39;a&#39;]&#34;</span>
</span></span><span class=line><span class=ln id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a></span><span class=cl><span class=m>10000000</span> loops, best of 5: 29.7 nsec per loop
</span></span></code></pre></div><h4 id=list-type><a href=#list-type aria-label=Anchor>#</a>
<code>list</code> type</h4><p>The Python&rsquo;s <code>list</code> type is defined in the <code>listobject.c</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a></span><span class=cl><span class=n>PyTypeObject</span> <span class=n>PyList_Type</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a></span><span class=cl><span class=c1></span>    <span class=p>(</span><span class=n>initproc</span><span class=p>)</span><span class=n>list___init__</span><span class=p>,</span> <span class=cm>/* tp_init */</span>
</span></span><span class=line><span class=ln id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a></span><span class=cl>    <span class=n>PyType_GenericAlloc</span><span class=p>,</span> <span class=cm>/* tp_alloc */</span>
</span></span><span class=line><span class=ln id=hl-14-5><a class=lnlinks href=#hl-14-5>5</a></span><span class=cl>    <span class=n>PyType_GenericNew</span><span class=p>,</span> <span class=cm>/* tp_new */</span>
</span></span><span class=line><span class=ln id=hl-14-6><a class=lnlinks href=#hl-14-6>6</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-14-7><a class=lnlinks href=#hl-14-7>7</a></span><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><code>PyType_GenericNew</code> does nothing &mdash; it ignores <code>args</code> and <code>kwargs</code>, and return an object allocated by
<code>type->typ_alloc</code>. Source: <a href=https://github.com/python/cpython/blob/main/Objects/typeobject.c#L1768 class=hide-external>https://github.com/python/cpython/blob/main/Objects/typeobject.c#L1768</a></p><p><code>PyType_GenericAlloc</code> allocated a new object and (if it&rsquo;s garbage-collectable) marks it as &ldquo;to-be-collected&rdquo;.</p><p><code>list___init__</code> is a convenience wrapper around the <code>list___init___impl</code> function, which does the actual initialization.
It does some basic pre-steps:</p><ul><li>fails if any <code>kwarg</code> has been passed,</li><li>fails if <code>args</code> has more than 1 element,</li><li>converts the first argument of <code>args</code> to an iterable.</li></ul><p><code>list___init___impl</code> clears the list (if not empty) and extends it by the provided iterable (by calling the
<code>list_extend</code> function).</p><div class="alert alert-warning"><h6 class=alert-heading><i class="bi bi-question-circle me-2" aria-hidden=true></i>
Question</h6><p class=my-3><p>I think the two:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a></span><span class=cl><span class=nb>list</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=ln id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a></span><span class=cl><span class=n>_tmp</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
</span></span><span class=line><span class=ln id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a></span><span class=cl><span class=n>_tmp</span><span class=o>.</span><span class=n>extend</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
</span></span></code></pre></div><p>are equivalent in every way (but the generated opcodes sequence) and are calling the same underlying C code.</p></p></div><h4 id=-literal-expression><a href=#-literal-expression aria-label=Anchor>#</a>
<code>[]</code> literal expression</h4><p>Opcode <code>BUILD_LIST</code> uses the <code>_PyList_FromArraySteal</code> function to construct a list object and return it.</p><div class="alert alert-info"><h6 class=alert-heading><i class="bi bi-pencil me-2" aria-hidden=true></i>
Note</h6><p class=my-3><p>_PyList_FromArraySteal is used since 3.12. See <a href=https://docs.python.org/3.12/whatsnew/changelog.html>3.12 changelog</a>
and <a href=https://github.com/python/cpython/pull/100147>gh-100146</a>. Before 3.12, the opcode was repeatedly calling <code>POP()</code>
to get items from the stack, and then inserting them into the list.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a></span><span class=cl><span class=k>while</span> <span class=p>(</span><span class=o>--</span><span class=n>oparg</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a></span><span class=cl>    <span class=n>PyObject</span> <span class=o>*</span><span class=n>item</span> <span class=o>=</span> <span class=nf>POP</span><span class=p>();</span>
</span></span><span class=line><span class=ln id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a></span><span class=cl>    <span class=nf>PyList_SET_ITEM</span><span class=p>(</span><span class=n>list</span><span class=p>,</span> <span class=n>oparg</span><span class=p>,</span> <span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>See <a href=https://github.com/python/cpython/pull/100147/files#diff-729a985b0cb8b431cb291f1edb561bbbfea22e3f8c262451cd83328a0936a342L1447-L1450>change in gh-100146 PR</a>.</p></p></div><p>The <code>_PyList_FromArraySteal</code> helper creates an empty list (if there are no items), or preallocates the list before
inserting items to it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a></span><span class=cl><span class=n>PyObject</span> <span class=o>**</span><span class=n>dst</span> <span class=o>=</span> <span class=n>list</span><span class=o>-&gt;</span><span class=n>ob_item</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a></span><span class=cl><span class=nf>memcpy</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>src</span><span class=p>,</span> <span class=n>n</span> <span class=o>*</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>PyObject</span> <span class=o>*</span><span class=p>));</span>
</span></span></code></pre></div><h3 id=sets><a href=#sets aria-label=Anchor>#</a>
Sets</h3><div class="alert alert-warning"><h6 class=alert-heading><i class="bi bi-exclamation-triangle me-2" aria-hidden=true></i>
Warning</h6><p class=my-3>AFAIK there&rsquo;s no way to construct a new set with a literal expression, hence the following analysis is performed for
sets with two elements: <code>1</code> and <code>2</code>.</p></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=ln id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a></span><span class=cl>$ python -m timeit <span class=s2>&#34;set((1, 2))&#34;</span>
</span></span><span class=line><span class=ln id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a></span><span class=cl><span class=m>5000000</span> loops, best of 5: 82.6 nsec per loop
</span></span><span class=line><span class=ln id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a></span><span class=cl>$ python -m timeit <span class=s2>&#34;{1, 2}&#34;</span>
</span></span><span class=line><span class=ln id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a></span><span class=cl><span class=m>5000000</span> loops, best of 5: 45.5 nsec per loop
</span></span></code></pre></div><h4 id=set-type><a href=#set-type aria-label=Anchor>#</a>
<code>set</code> type</h4><p>The Python&rsquo;s <code>set</code> type is defined in the <code>setobject.c</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a></span><span class=cl><span class=n>PyTypeObject</span> <span class=n>PySet_Type</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a></span><span class=cl><span class=c1></span>    <span class=p>(</span><span class=n>initproc</span><span class=p>)</span><span class=n>set_init</span><span class=p>,</span> <span class=cm>/* tp_init */</span>
</span></span><span class=line><span class=ln id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a></span><span class=cl>    <span class=n>PyType_GenericAlloc</span><span class=p>,</span> <span class=cm>/* tp_alloc */</span>
</span></span><span class=line><span class=ln id=hl-17-5><a class=lnlinks href=#hl-17-5>5</a></span><span class=cl>    <span class=n>set_new</span><span class=p>,</span> <span class=cm>/* tp_new */</span>
</span></span><span class=line><span class=ln id=hl-17-6><a class=lnlinks href=#hl-17-6>6</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-17-7><a class=lnlinks href=#hl-17-7>7</a></span><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><code>set_new</code> uses the allocated to create a new empty set object. Internally it calls the <code>make_new_set</code> function.</p><p><code>set_init</code> performs some pre-steps:</p><ul><li>fails if any <code>kwarg</code> has been passed,</li><li>fails if <code>args</code> has more then 1 element,</li><li>converts the first argument of <code>args</code> to an iterable,</li><li>if the set object has already been filled, then it clears it</li></ul><p>&mldr; and calls the <code>set_update_internal</code> function, to insert values into the set object.</p><h4 id=1-2-literal-expression><a href=#1-2-literal-expression aria-label=Anchor>#</a>
<code>{1, 2}</code> literal expression</h4><p>The opcode handler has no dedicated helpers. It constructs a new set (empty), and then iterates over all items from the
stack and insets them one-by-one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-18-1><a class=lnlinks href=#hl-18-1> 1</a></span><span class=cl><span class=nf>inst</span><span class=p>(</span><span class=n>BUILD_SET</span><span class=p>,</span> <span class=p>(</span><span class=n>values</span><span class=p>[</span><span class=n>oparg</span><span class=p>]</span> <span class=o>--</span> <span class=n>set</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-18-2><a class=lnlinks href=#hl-18-2> 2</a></span><span class=cl>    <span class=n>set</span> <span class=o>=</span> <span class=nf>PySet_New</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-18-3><a class=lnlinks href=#hl-18-3> 3</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>set</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-18-4><a class=lnlinks href=#hl-18-4> 4</a></span><span class=cl>    <span class=nf>GOTO_ERROR</span><span class=p>(</span><span class=n>error</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-18-5><a class=lnlinks href=#hl-18-5> 5</a></span><span class=cl>    <span class=kt>int</span> <span class=n>err</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln id=hl-18-6><a class=lnlinks href=#hl-18-6> 6</a></span><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>oparg</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-18-7><a class=lnlinks href=#hl-18-7> 7</a></span><span class=cl>        <span class=n>PyObject</span> <span class=o>*</span><span class=n>item</span> <span class=o>=</span> <span class=n>values</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln id=hl-18-8><a class=lnlinks href=#hl-18-8> 8</a></span><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>err</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-18-9><a class=lnlinks href=#hl-18-9> 9</a></span><span class=cl>            <span class=n>err</span> <span class=o>=</span> <span class=nf>PySet_Add</span><span class=p>(</span><span class=n>set</span><span class=p>,</span> <span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-18-10><a class=lnlinks href=#hl-18-10>10</a></span><span class=cl>        <span class=nf>Py_DECREF</span><span class=p>(</span><span class=n>item</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-18-11><a class=lnlinks href=#hl-18-11>11</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-18-12><a class=lnlinks href=#hl-18-12>12</a></span><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>err</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-18-13><a class=lnlinks href=#hl-18-13>13</a></span><span class=cl>        <span class=nf>Py_DECREF</span><span class=p>(</span><span class=n>set</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-18-14><a class=lnlinks href=#hl-18-14>14</a></span><span class=cl>        <span class=nf>ERROR_IF</span><span class=p>(</span><span class=nb>true</span><span class=p>,</span> <span class=n>error</span><span class=p>);</span>
</span></span><span class=line><span class=ln id=hl-18-15><a class=lnlinks href=#hl-18-15>15</a></span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln id=hl-18-16><a class=lnlinks href=#hl-18-16>16</a></span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Source: <a href=https://github.com/python/cpython/blob/main/Python/bytecodes.c#L1627 class=hide-external>https://github.com/python/cpython/blob/main/Python/bytecodes.c#L1627</a>.</p><div class="alert alert-warning"><h6 class=alert-heading><i class="bi bi-exclamation-triangle me-2" aria-hidden=true></i>
Warning</h6><p class=my-3><p>Warning
The generated bytecode is different if we add another argument to the literal expression: <code>{1, 2, 3}</code>. Then it becomes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a></span><span class=cl>   <span class=mi>2</span> <span class=n>BUILD_SET</span>                <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a></span><span class=cl>   <span class=mi>4</span> <span class=n>LOAD_CONST</span>               <span class=mi>1</span> <span class=p>(</span><span class=nb>frozenset</span><span class=p>({</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>}))</span>
</span></span><span class=line><span class=ln id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a></span><span class=cl>   <span class=mi>6</span> <span class=n>SET_UPDATE</span>               <span class=mi>1</span>
</span></span><span class=line><span class=ln id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a></span><span class=cl>   <span class=mi>8</span> <span class=n>RETURN_VALUE</span>
</span></span></code></pre></div></p></div><h3 id=tuples><a href=#tuples aria-label=Anchor>#</a>
Tuples</h3><p>This one&rsquo;s tricky. Constructing a tuple with the <code>tuple</code> type requires an iterable. The easiest way of getting one it to
create a tuple literal, which is obviously less efficient, than using a tuple literal syntax in the first place.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=ln id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=ln id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>sys</span><span class=o>.</span><span class=n>version_info</span>
</span></span><span class=line><span class=ln id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a></span><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>version_info</span><span class=p>(</span><span class=n>major</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>minor</span><span class=o>=</span><span class=mi>12</span><span class=p>,</span> <span class=n>micro</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>releaselevel</span><span class=o>=</span><span class=s1>&#39;final&#39;</span><span class=p>,</span> <span class=n>serial</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span>
</span></span><span class=line><span class=ln id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>a</span><span class=p>():</span>
</span></span><span class=line><span class=ln id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a></span><span class=cl><span class=o>...</span>   <span class=k>return</span> <span class=nb>tuple</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=p>[]))</span>
</span></span><span class=line><span class=ln id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span>
</span></span><span class=line><span class=ln id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=k>def</span> <span class=nf>b</span><span class=p>():</span>
</span></span><span class=line><span class=ln id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a></span><span class=cl><span class=o>...</span>   <span class=k>return</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=ln id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span>
</span></span><span class=line><span class=ln id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=kn>import</span> <span class=nn>dis</span>
</span></span><span class=line><span class=ln id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span>
</span></span><span class=line><span class=ln id=hl-19-13><a class=lnlinks href=#hl-19-13>13</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-14><a class=lnlinks href=#hl-19-14>14</a></span><span class=cl>  <span class=mi>1</span>           <span class=mi>0</span> <span class=n>RESUME</span>                   <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-19-15><a class=lnlinks href=#hl-19-15>15</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-19-16><a class=lnlinks href=#hl-19-16>16</a></span><span class=cl>  <span class=mi>2</span>           <span class=mi>2</span> <span class=n>LOAD_GLOBAL</span>              <span class=mi>1</span> <span class=p>(</span><span class=n>NULL</span> <span class=o>+</span> <span class=nb>tuple</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-17><a class=lnlinks href=#hl-19-17>17</a></span><span class=cl>             <span class=mi>12</span> <span class=n>LOAD_CONST</span>               <span class=mi>1</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-18><a class=lnlinks href=#hl-19-18>18</a></span><span class=cl>             <span class=mi>14</span> <span class=n>LOAD_CONST</span>               <span class=mi>2</span> <span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-19><a class=lnlinks href=#hl-19-19>19</a></span><span class=cl>             <span class=mi>16</span> <span class=n>BUILD_LIST</span>               <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-19-20><a class=lnlinks href=#hl-19-20>20</a></span><span class=cl>             <span class=mi>18</span> <span class=n>BUILD_TUPLE</span>              <span class=mi>3</span>
</span></span><span class=line><span class=ln id=hl-19-21><a class=lnlinks href=#hl-19-21>21</a></span><span class=cl>             <span class=mi>20</span> <span class=n>CALL</span>                     <span class=mi>1</span>
</span></span><span class=line><span class=ln id=hl-19-22><a class=lnlinks href=#hl-19-22>22</a></span><span class=cl>             <span class=mi>28</span> <span class=n>RETURN_VALUE</span>
</span></span><span class=line><span class=ln id=hl-19-23><a class=lnlinks href=#hl-19-23>23</a></span><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-24><a class=lnlinks href=#hl-19-24>24</a></span><span class=cl>  <span class=mi>1</span>           <span class=mi>0</span> <span class=n>RESUME</span>                   <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-19-25><a class=lnlinks href=#hl-19-25>25</a></span><span class=cl>
</span></span><span class=line><span class=ln id=hl-19-26><a class=lnlinks href=#hl-19-26>26</a></span><span class=cl>  <span class=mi>2</span>           <span class=mi>2</span> <span class=n>LOAD_CONST</span>               <span class=mi>1</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-27><a class=lnlinks href=#hl-19-27>27</a></span><span class=cl>              <span class=mi>4</span> <span class=n>LOAD_CONST</span>               <span class=mi>2</span> <span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=ln id=hl-19-28><a class=lnlinks href=#hl-19-28>28</a></span><span class=cl>              <span class=mi>6</span> <span class=n>BUILD_LIST</span>               <span class=mi>0</span>
</span></span><span class=line><span class=ln id=hl-19-29><a class=lnlinks href=#hl-19-29>29</a></span><span class=cl>              <span class=mi>8</span> <span class=n>BUILD_TUPLE</span>              <span class=mi>3</span>
</span></span><span class=line><span class=ln id=hl-19-30><a class=lnlinks href=#hl-19-30>30</a></span><span class=cl>             <span class=mi>10</span> <span class=n>RETURN_VALUE</span>
</span></span></code></pre></div><p>It might not make much sense to include this example in the article.</p><h4 id=tuple-type><a href=#tuple-type aria-label=Anchor>#</a>
<code>tuple</code> type</h4><p>The Python&rsquo;s <code>tuple</code> type is defined in <code>tupleobject.c</code>. Interestingly, it has no <code>tp_alloc</code>, nor <code>tp_init</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=ln id=hl-20-1><a class=lnlinks href=#hl-20-1>1</a></span><span class=cl><span class=n>PyTypeObject</span> <span class=n>PyTuple_Type</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln id=hl-20-2><a class=lnlinks href=#hl-20-2>2</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-20-3><a class=lnlinks href=#hl-20-3>3</a></span><span class=cl><span class=c1></span>    <span class=mi>0</span><span class=p>,</span> <span class=cm>/* tp_init */</span>
</span></span><span class=line><span class=ln id=hl-20-4><a class=lnlinks href=#hl-20-4>4</a></span><span class=cl>    <span class=mi>0</span><span class=p>,</span> <span class=cm>/* tp_alloc */</span>
</span></span><span class=line><span class=ln id=hl-20-5><a class=lnlinks href=#hl-20-5>5</a></span><span class=cl>    <span class=n>tuple_new</span><span class=p>,</span> <span class=cm>/* tp_new */</span>
</span></span><span class=line><span class=ln id=hl-20-6><a class=lnlinks href=#hl-20-6>6</a></span><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=ln id=hl-20-7><a class=lnlinks href=#hl-20-7>7</a></span><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>The <code>tuple_new</code> function is responsible for allocating a new tuple object, with the items passed as a parameter.</p></main><div class=tags><a class="text-decoration-none text-reset hover-success" href=https://madebyme.today/tags/python/>Python</a>
<a class="text-decoration-none text-reset hover-success" href=https://madebyme.today/tags/cpython/>CPython</a>
<a class="text-decoration-none text-reset hover-success" href=https://madebyme.today/tags/dictionaries/>dictionaries</a></div><div class=social-media><a href="https://facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmadebyme.today%2Fblog%2Fpython-dict-vs-curly-brackets%2F&amp;t=Performance+Analysis+of+Python%27s+%60dict%28%29%60+and+%60%7B%7D%60+-+MadeByMe" class=hide-external target=_blank rel=me title="Share on Facebook"><span class=inline-svg><svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M22 12C22 6.47714 17.5229 1.99999 12 1.99999 6.47715 1.99999 2 6.47714 2 12c0 4.9913 3.65686 9.1283 8.4375 9.8785V14.8906H7.89844V12H10.4375V9.79687c0-2.50625 1.4929-3.89063 3.7771-3.89063C15.3087 5.90624 16.4531 6.10155 16.4531 6.10155V8.56249h-1.261c-1.2422.0-1.6296.77084-1.6296 1.56171V12h2.7734L15.8926 14.8906H13.5625v6.9879C18.3431 21.1283 22 16.9913 22 12z" stroke-linejoin="round"/></svg></span></a><a href="https://twitter.com/intent/tweet/?url=https%3A%2F%2Fmadebyme.today%2Fblog%2Fpython-dict-vs-curly-brackets%2F&amp;text=Performance+Analysis+of+Python%27s+%60dict%28%29%60+and+%60%7B%7D%60+-+MadeByMe" class=hide-external target=_blank rel=me title="Share on Twitter"><span class=inline-svg><svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M21.9999 5.9246C21.2644 6.25051 20.4744 6.47071 19.6437 6.57025 20.4911 6.06289 21.1411 5.25782 21.4477 4.29948c-.7928.47036-1.671.81212-2.6055.99533C18.0935 4.49855 17.0277 4 15.8474 4c-2.2655.0-4.1029 1.8374-4.1029 4.10464C11.7445 8.42526 11.7815 8.73707 11.8502 9.03832 8.43877 8.86656 5.41666 7.23263 3.39252 4.75046c-.35233.60777-.55492 1.31243-.55492 2.06289.0 1.42342.72492 2.68035 1.82507 3.41585C3.98972 10.2072 3.35729 10.0231 2.80413 9.71567V9.76852c0 1.98798 1.41373 3.64658 3.29164 4.02358C5.75049 13.8855 5.38847 13.9348 5.015 13.9348 4.75075 13.9348 4.49267 13.9102 4.24252 13.8626c.52233 1.6295 2.03735 2.8169 3.83335 2.8486-1.40492 1.101-3.1745 1.7572-5.09645 1.7572C2.64823 18.4684 2.32144 18.449 1.99994 18.4112c1.81626 1.1653 3.97252 1.8435 6.28909 1.8435 7.54867.0 11.67537-6.2521 11.67537-11.67441C19.9644 8.40412 19.9599 8.2262 19.952 8.05003 20.7536 7.47045 21.4494 6.74905 21.9982 5.92724L21.9999 5.9246z" stroke-linejoin="round"/></svg></span></a><a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fmadebyme.today%2Fblog%2Fpython-dict-vs-curly-brackets%2F&amp;title=Performance+Analysis+of+Python%27s+%60dict%28%29%60+and+%60%7B%7D%60+-+MadeByMe&amp;source=https%3A%2F%2Fmadebyme.today%2F" class=hide-external target=_blank rel=me title="Share on LinkedIn"><span class=inline-svg><svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M22 3.47059V20.5294C22 20.9194 21.845 21.2935 21.5692 21.5693 21.2935 21.8451 20.9194 22 20.5294 22H3.47056C3.08053 22 2.70648 21.8451 2.43069 21.5693 2.15491 21.2935 1.99997 20.9194 1.99997 20.5294V3.47059c0-.39003.15494-.76408.43072-1.03986C2.70648 2.15494 3.08053 2 3.47056 2H20.5294C20.9194 2 21.2935 2.15494 21.5692 2.43073 21.845 2.70651 22 3.08056 22 3.47059v0zM7.88232 9.64706H4.94115V19.0588H7.88232V9.64706zM8.14703 6.41176C8.14858 6.18929 8.10629 5.96869 8.02258 5.76255 7.93888 5.55642 7.81539 5.36879 7.65916 5.21039c-.15622-.15841-.34211-.2845-.54706-.37106S6.68715 4.70742 6.46468 4.70588H6.41173c-.45242.0-.88632.17973-1.20624.49964-.31991.31992-.49964.75382-.49964 1.20624.0.45243.17973.88633.49964 1.20625C5.52541 7.93792 5.95931 8.11765 6.41173 8.11765v0C6.63423 8.12312 6.85562 8.0847 7.06325 8.00458 7.27089 7.92447 7.46071 7.80422 7.62186 7.65072 7.78301 7.49722 7.91234 7.31346 8.00245 7.10996 8.09256 6.90646 8.14169 6.6872 8.14703 6.46471V6.41176zM19.0588 13.3412c0-2.8294-1.8-3.92943-3.5882-3.92943C14.8851 9.38245 14.3021 9.50715 13.7798 9.77345 13.2576 10.0397 12.8142 10.4383 12.4941 10.9294H12.4117V9.64706H9.64703V19.0588H12.5882V14.0529C12.5457 13.5403 12.7072 13.0315 13.0376 12.6372 13.368 12.2429 13.8407 11.9949 14.3529 11.9471H14.4647C15.4 11.9471 16.0941 12.5353 16.0941 14.0176v5.0412h2.9412L19.0588 13.3412z" stroke-linejoin="round"/></svg></span></a><a href="https://www.reddit.com/submit?url=https%3A%2F%2Fmadebyme.today%2Fblog%2Fpython-dict-vs-curly-brackets%2F&amp;title=Performance+Analysis+of+Python%27s+%60dict%28%29%60+and+%60%7B%7D%60+-+MadeByMe" class=hide-external target=_blank rel=me title="Share on Reddit"><span class=inline-svg><svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M8.83552 12.4444C8.72564 12.6089 8.66699 12.8022 8.66699 13 8.66699 13.1313 8.69285 13.2614 8.74311 13.3827 8.79336 13.504 8.86702 13.6142 8.95988 13.7071S9.16298 13.8736 9.2843 13.9239C9.40563 13.9741 9.53567 14 9.66699 14 9.86477 14 10.0581 13.9414 10.2226 13.8315c.164400000000001-.1099.2926-.2661.3683-.4488C10.6666 13.2 10.6864 12.9989 10.6478 12.8049 10.6092 12.6109 10.5139 12.4327 10.3741 12.2929 10.2342 12.153 10.0561 12.0578 9.86208 12.0192 9.6681 11.9806 9.46703 12.0004 9.2843 12.0761 9.10158 12.1518 8.9454 12.28 8.83552 12.4444z" stroke-linejoin="round"/><path fill="none" d="M13.7414 13.8715C13.9059 13.9814 14.0992 14.04 14.297 14.04L14.287 14.08C14.4226 14.0815 14.5571 14.0553 14.6822 14.0032 14.8074 13.9511 14.9207 13.874 15.0152 13.7767 15.1096 13.6795 15.1833 13.564 15.2318 13.4373 15.2802 13.3107 15.3024 13.1755 15.297 13.04 15.297 12.8422 15.2383 12.6489 15.1285 12.4844 15.0186 12.32 14.8624 12.1918 14.6797 12.1161 14.4969 12.0404 14.2959 12.0206 14.1019 12.0592 13.9079 12.0978 13.7297 12.193 13.5899 12.3329 13.45 12.4727 13.3548 12.6509 13.3162 12.8449 13.2776 13.0389 13.2974 13.24 13.3731 13.4227 13.4488 13.6054 13.577 13.7616 13.7414 13.8715z" stroke-linejoin="round"/><path fill="none" fill-rule="evenodd" clip-rule="evenodd" d="M21.997 12c0 5.5228-4.4772 10-10 10C6.47415 22 1.99699 17.5228 1.99699 12c0-5.52285 4.47716-10 10.00001-10 5.5228.0 10 4.47715 10 10zM18.4035 11.2154C18.5652 11.446 18.6567 11.7185 18.667 12 18.6712 12.2755 18.5974 12.5467 18.4541 12.782 18.3108 13.0174 18.1038 13.2073 17.857 13.33 17.8682 13.4765 17.8682 13.6236 17.857 13.77c0 2.24-2.61 4.06-5.83 4.06-3.22001.0-5.83001-1.82-5.83001-4.06-.01126-.1464-.01126-.2935.0-.44C6.00465 13.2416 5.83382 13.1125 5.69635 12.9515 5.55887 12.7906 5.45804 12.6017 5.40084 12.3979 5.34363 12.1941 5.33143 11.9803 5.36506 11.7713 5.3987 11.5623 5.47737 11.3632 5.59563 11.1876c.11826-.1755.27328-.3233.45431-.433.18103-.1096.38375-.178699999999999.5941-.2022C6.85439 10.5288 7.06736 10.5513 7.26816 10.6182 7.46897 10.6852 7.65283 10.795 7.80699 10.94 8.95926 10.1585 10.3149 9.73099 11.707 9.71L12.447 6.24C12.4553 6.19983 12.4715 6.16171 12.4946 6.12784 12.5178 6.09398 12.5474 6.06505 12.5819 6.04272 12.6163 6.0204 12.6548 6.00513 12.6951 5.99779 12.7355 5.99046 12.7769 5.99121 12.817 6l2.45.49C15.3866 6.28444 15.5756 6.12825 15.8001 6.04948 16.0245 5.9707 16.2696 5.9745 16.4915 6.06019 16.7134 6.14587 16.8975 6.30784 17.0107 6.51701 17.1239 6.72617 17.1589 6.96885 17.1093 7.20147 17.0597 7.4341 16.9288 7.64143 16.7402 7.78627 16.5515 7.9311 16.3174 8.00394 16.0799 7.99172 15.8423 7.9795 15.6169 7.88301 15.4441 7.71958 15.2713 7.55615 15.1624 7.33648 15.137 7.1L12.997 6.65l-.65 3.12C13.7222 9.7995 15.0594 10.2267 16.197 11 16.4002 10.805 16.6555 10.6729 16.9321 10.6196 17.2087 10.5664 17.4948 10.5943 17.7559 10.7 18.0169 10.8057 18.2419 10.9847 18.4035 11.2154z" stroke-linejoin="round"/><path fill="none" fill-rule="evenodd" clip-rule="evenodd" d="M9.75838 15.5632C9.75455 15.5601 9.74967 15.5585 9.74472 15.5587 9.73976 15.559 9.73506 15.5611 9.73155 15.5646 9.72804 15.5681 9.72596 15.5728 9.72572 15.5777L9.7257 15.5788c.6563.481 1.457.725099999999999 2.2709.6914C12.0035 16.2699 12.0104 16.2699 12.0173 16.2702 12.837 16.3042 13.6432 16.0564 14.3021 15.5686 14.2996 15.5663 14.2967 15.5644 14.2936 15.563 14.29 15.5615 14.2862 15.5607 14.2824 15.5607 14.2746 15.5606 14.2671 15.5636 14.2615 15.569 14.2525 15.5778 14.2429 15.5858 14.2327 15.5931 13.5829 16.0593 12.7942 16.2909 11.9958 16.2503 11.1982 16.2831 10.413 16.0439 9.76912 15.5716L9.75838 15.5632z" stroke-linejoin="round"/></svg></span></a></div><aside class="alert alert-info"><h6 class="alert-heading mb-0"><i class="bi bi-bell-fill me-2 notification-bell" aria-hidden=true></i>
Interested in my work?</h6><p class=my-3>Consider subscribing to the <a href=https://madebyme.today/index.xml title="RSS Feed">RSS Feed</a> or
joining my mailing list:
<a href=https://groups.google.com/g/madebyme-notifications>madebyme-notifications on Google Groups
</a>.</p><hr class=mb-0><p class="my-1 small text-secondary"><b>Disclaimer:</b> Only group owner (i.e. me) can view e-mail addresses of group members.
I will not share your e-mail with any third-parties &mdash; it will be used exclusively to
notify you about new blog posts.</p></aside><hr><script>let theme=getStoredTheme();theme===null&&(theme=getPreferredTheme());let giscusAttributes={src:"https://giscus.app/client.js","data-repo":"nathiss/nathiss.github.io","data-repo-id":"MDEwOlJlcG9zaXRvcnk4MDYyNjk2Ng==","data-category":"Announcements","data-category-id":"DIC_kwDOBM5FFs4CYJcb","data-mapping":"pathname","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":theme,"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t)),document.querySelector("article.entry").appendChild(giscusScript)</script></article></div></div></div></main><footer class="mt-auto d-flex justify-content-center py-3 lh-1"><p class=m-0>Copyright &copy;
2023-2024</p><p class="m-0 ms-1"><span class=text-success>Kamil</span>
Rusin</p><p class="m-0 ms-1">/</span><p class="m-0 ms-1"><a href=/privacy/>Privacy</a></p></footer><div class="toast-container p-3 bottom-0 end-0 position-fixed"><div id=madebyme-consent-banner class="toast bg-body"><div class=toast-header><strong class=me-auto>Cookies 🍪</strong>
<button type=button class="btn-close d-flex justify-content-center align-items-center" data-bs-dismiss=toast aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" viewBox="0 0 16 16"><path d="M2.146 2.854a.5.5.0 11.708-.708L8 7.293l5.146-5.147a.5.5.0 01.708.708L8.707 8l5.147 5.146a.5.5.0 01-.708.708L8 8.707l-5.146 5.147a.5.5.0 01-.708-.708L7.293 8 2.146 2.854z"/></svg></button></div><div class=toast-body><p>This website uses <a href=https://marketingplatform.google.com/about/analytics/>Google Analytics 4</a> to
gather data about page views and <a href=https://giscus.app/>Giscus</a> to support article comments.</p><p>This website respects <b><a href=https://en.wikipedia.org/wiki/Do_Not_Track>Do Not Track</a></b> header field.
If you do not wish to be tracked by Google Analytics, then please enable <b>Do Not Track</b> for this domain.</p><p>If you wish to know more about data gathered on this website, read <a href=/privacy/>About Tracking & Data Collection</a>.</p><div class="d-flex justify-content-center"><button id=consent-button class="btn btn-success btn-sm py-2 px-4 rounded text-light">I acknowledge, don't show me this again</button></div></div></div></div><script>const consentBannerKey="madebyme-given-consent",consentBannerVersion="5";document.getElementById("consent-button").addEventListener("click",()=>{localStorage.setItem(consentBannerKey,consentBannerVersion),document.getElementById("madebyme-consent-banner").classList.remove("show")});const localBannerVersion=localStorage.getItem(consentBannerKey);localBannerVersion!==consentBannerVersion&&document.getElementById("madebyme-consent-banner").classList.add("show")</script><script>const themeToggler=document.getElementById("theme-toggler");themeToggler.addEventListener("click",()=>{const e=getStoredTheme();e===null?setTheme("light"):e==="light"?setTheme("dark"):e==="dark"&&setTheme("auto")}),themeToggler.addEventListener("mousemove",()=>{const e=getStoredTheme();switch(e){case"light":themeToggler.title="Light theme mode";break;case"dark":themeToggler.title="Dark theme mode";break;case null:themeToggler.title="Auto theme mode";break;default:console.warn(`Unknown themeMode: ${e}`);break}})</script><script src=https://madebyme.today/3rd-party/bootstrap/dist/js/bootstrap.bundle.min.5ff6240d9ca34dfe30c9cd95cb5e981823c7c0063cad9258f8f3a0a24663401da684844524272410673a6325fd78db0f7e7d0fcd3844b8db3eb9aa2613908ee8.js integrity="sha512-X/YkDZyjTf4wyc2Vy16YGCPHwAY8rZJY+POgokZjQB2mhIRFJCckEGc6YyX9eNsPfn0PzThEuNs+uaomE5CO6A=="></script><script type=application/ld+json>{"@context":"https://schema.org/","@type":"Webpage","mainContentOfPage":{"@context":"https://schema.org/","@type":"WebPageElement","cssSelector":".site-main"},"primaryImageOfPage":"https://madebyme.today/polaris-1920x1080.webp"}</script><script type=application/ld+json>{"@context":"https://schema.org/","@type":"WebSite","name":"MadeByMe","alternateName":"MadeByMe","url":"https://madebyme.today/","description":"I'm Kamil; I work as a software engineer and this is a collection of all things I've been working on in my personal time.","disambiguatingDescription":"I'm Kamil; I work as a software engineer and this is a collection of all things I've been working on in my personal time.","isFamilyFriendly":"true","thumbnailUrl":"https://madebyme.today/favicons/favicon-180x180-box-light.png","image":"https://madebyme.today/favicons/favicon-180x180-box-light.png","inLanguage":"en-us","sameAs":["https://www.madebyme.today","https://www.madebyme.today/","https://madebyme.today","index.xml"],"author":{"@context":"https://schema.org/","@type":"Person","gender":"male","email":"kamil.jakub.rusin@gmail.com","givenName":"Kamil","familyName":"Rusin","name":"Kamil Rusin","jobTitle":"Software Engineer","nationality":{"@context":"https://schema.org/","@type":"Country","name":"PL"},"alumniOf":{"@context":"https://schema.org/","@type":"CollegeOrUniversity","url":"https://www.pk.edu.pl/","name":"The Cracow University of Technology"},"url":"https:\/\/madebyme.today\/"}}</script></body></html>